public class clsExtensionMonthlyTimesheetView_Stipend {
    public boolean displayPopup {get; set;}
    public boolean IsTimesheetEntries {get;set;}
    public Monthly_Timesheet__c objMonthlyTimeSheet {get;set;}
    public list<MainWrapper> lstMainWrapper {get;set;}
    public Profile objProfile {get;set;}
    public map<string,string> mapOfDaysVsdays {get;set;}
    List<String> args = new String[]{'0','number','###,###,##0.00'};
    public decimal TotalNEH {get;set;}
    public decimal TotalTotalHours {get;set;} 
    public decimal TotalUNEH {get;set;}
    public decimal TotalHolidays {get;set;}
    public decimal TotalSickLeave {get;set;}
    public decimal TotalVacationLeave {get;set;}
    public decimal TotaldecDEEH {get;set;}
    public decimal TotaldecEDEEH {get;set;}
    public decimal TotalHolidayExcess {get;set;}
    public decimal TotalPersonalHoliday {get;set;}
    public list<mainWrapperPopup> lstOfWrapperPopup {get;set;}
    public list<mainWrapperPopup1> mlstOfWrapperPopup {get;set;}
    public list<mainWrapperPopup2> llstOfWrapperPopup {get;set;}
    public decimal TotalHours {get;set;}
    public decimal TotalPaidHours {get;set;}
    public Date timesheetEntryDate {get;set;}
    public String strDailyTimesheetDate {get;set;}
    public Pay_Period_Leave_Balances__c objPayPeriodLeaveBalance {get;set;}
    public string selectedversions {get;set;}
    string strMonthlyTimesheetId = '';
    public list<MTS_Days__c> lstOfVersioningMTSEntries {get;set;}
    public Date dtDateOfInjury {get;set;}
    public string dateTimeZone {get;set;}
    public string strViewVersion {get;set;}
    public boolean IsselectionVersion {get;set;}
    public boolean IsveiwVersions {get;set;}
    public boolean personalsection {get;set;}
    public list<String> lstOfErrorMessages {get;set;}
    public boolean disableSubmittedToHr {get;set;}
    public boolean disableReject {get;set;}
    public boolean disableSubmitToSCO {get;set;}
    public boolean disableManuallyKeyed {get;set;}
    public boolean IsCheckSubmittedToHr {get;set;}
    public boolean IsCheckSCOAndReject {get;set;}
    public boolean IsCheckSendDocuSign {get;set;}
    public boolean IsStipendEnable {get;set;}
    public list<string> SHList{get;set;}
    public string MTSStatus {get;set;}
    public map<string,string> mapOfDateVsStateHoliday{get;set;}
    public map<string,string> mapOfDateVsStateHoliday1{get;set;}
    public map<string,string> mapOfDateVsStateHoliday2{get;set;}
    
    Map<date,list<State_Holiday__c>> mapOfStateCanlender {get;set;} 
    Map<id,list<date>> dateMap = New map<id,list<date>>();
    set<integer> CCC = new set<integer>();
    public list<Monthly_Timesheet__c> sizelist {get;set;}  
    public list<string> sizelistName {get;set;}  
    
    public clsExtensionMonthlyTimesheetView_Stipend(ApexPages.StandardController controller) { 
        sizelist = new list<Monthly_Timesheet__c>();
        sizelistName = new list<string>();
        dateTimeZone = system.Now().format('EEEE, MMMM d, yyyy, hh:mm:aa');
        strMonthlyTimesheetId =  ApexPages.CurrentPage().getParameters().get('Id');
        strViewVersion =  ApexPages.CurrentPage().getParameters().get('view');
        if(ApexPages.CurrentPage().getParameters().get('view') == null){
            strViewVersion = '';
        }
        lstOfErrorMessages = new list<String>();
        mapOfDateVsStateHoliday = new map<string,string>();
        mapOfDateVsStateHoliday1 = new map<string,string>();
        mapOfDateVsStateHoliday2 = new map<string,string>();
        mapOfStateCanlender = new Map<date,list<State_Holiday__c>>();
        // system.debug('strViewVersion==================>'+strViewVersion);
        lstOfVersioningMTSEntries = new list<MTS_Days__c>();
        objProfile = new Profile();
        objProfile = C3Common.getLoggedInUserProfile();
        IsTimesheetEntries = false;
        //fetch record with Monthly Time Sheet Object.
        //  system.debug('strMonthlyTimesheetId ::: '+strMonthlyTimesheetId );
        if(strMonthlyTimesheetId != ''){
            list<Monthly_Timesheet__c> lstOfMonthlyTimesheet = new list<Monthly_Timesheet__c>();
            objMonthlyTimeSheet = new Monthly_Timesheet__c();
            lstOfMonthlyTimesheet = [select id,MTSDV__c,MT_Version__c,Contact__c,Contact__r.Unit__r.Name,Position__c,Position__r.Worker_Type__c,Position__r.Position_Effective_Date__c,EEHR__c,
                                     BSU__c,BSA__c,DD__c,DNE__c,NPCD__c,TEEEH__c,TNEEEH__c,TEET__c,PS__c,
                                     Position__r.Position_Expiration_Date__c,Monthly_Timesheet_Status__c,Pay_Period_Start_Date__c,Pay_Period_End_Date__c,Submitted_to_SCO_Date__c, 
                                     Total_Paid_Hours__c,Total_PTO_Hours_Used__c,SU__c,EETB__c,PD__c,DPA__c,EET__c,
                                     STI_Available_Personal_Leave_Credits__c,STI_Awarded_Personal_Leave_Credits__c,STI_Balance_Personal_Leave_Credits__c,
                                     STI_Used_Personal_Leave_Credits__c,STI_Personal_Leave_Adjustment__c,NASA__c,DIM__c,EEHM__c,
                                     TEETBSTSCO__c,TNEETBSTSCO__c,SASTSCO__c,
                                     STI_Available_Holiday_Leave_Credits__c,STI_Awarded_Holiday_Leave_Credits__c,STI_Balance_Holiday_Leave_Credits__c,STI_Used_Holiday_Leave_Credits__c,STI_Separations_Cashout__c from Monthly_Timesheet__c where id =:strMonthlyTimesheetId limit 1];
            system.debug('lstOfMonthlyTimesheet::: '+lstOfMonthlyTimesheet );
            if(lstOfMonthlyTimesheet.size()>0)
                objMonthlyTimeSheet = lstOfMonthlyTimesheet[0];
            //   system.debug('objMonthlyTimeSheet ::: '+objMonthlyTimeSheet );
        }
        //Map Prepared to Days wise.
        mapOfDaysVsdays = new map<string,string>();
        mapOfDaysVsdays.put('Sunday','Su');
        mapOfDaysVsdays.put('Monday','Mo');
        mapOfDaysVsdays.put('Tuesday','Tu');
        mapOfDaysVsdays.put('Wednesday','We');
        mapOfDaysVsdays.put('Thursday','Th');
        mapOfDaysVsdays.put('Friday','Fr');
        mapOfDaysVsdays.put('Saturday','Sa');
        
        if(objMonthlyTimeSheet.id != null){ 
              selectedversions = string.valueOf(objMonthlyTimeSheet.MTSDV__c);
               MTSStatus = objMonthlyTimeSheet.Monthly_Timesheet_Status__c ;
            system.debug('MTSStatus '+MTSStatus);
            //Button Enable or Disable as per Status Condtion in load page.  
            
            if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Submitted to HR' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Ready For SCO' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Submitted to SCO' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Manually Keyed' ) {
           
                disableSubmittedToHr = true;               
            }
            if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Ready For SCO' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == null){
                //  disableSubmittedToHr = true; 
                disableSubmitToSCO = true;
                disableReject = true; 
                
            }
            if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Manually Keyed' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == null){
                // disableSubmittedToHr = true; 
                //  disableSubmitToSCO = true;
                disableManuallyKeyed = true;
                disableReject = true;
            }
            if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Submitted to SCO' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == null){
                disableReject = true;
            }
            if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Rejected' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == null){
                disableReject = true;
            }
          
            
            if(objMonthlyTimeSheet.MTSDV__c >= 1){
                IsveiwVersions =  true;
                IsselectionVersion = true;
            }        
            if(selectedversions != null){
                //  IsselectionVersion = false;
                
                //system.debug('lstOfVersioningMTSEntries======@@@@==========='+lstOfVersioningMTSEntries);  
                for(MTS_Days__c objMTSDay:[select id,(select id,Daily_Timesheet__c,Time_Entry_Date__c from Daily_Time_Entries__r limit 1),DTS_Ids__c ,DEH__c,EPD__c,Enrolled__c,Misc_Time__c,MA__c,WC__c,Total_Hours__c,DEEH__c,Time_Entry_Date__c,
                                             Holiday_Leave__c,NEH__c,Personal_Leave__c,UNEH__c,Version__c,NEDEEH__c,EDEEH__c
                                             from MTS_Days__c where Monthly_Timesheet__c =:objMonthlyTimeSheet.id and Active__c = true]){
                    if(objMTSDay.Version__c != null)
                    {
                        lstOfVersioningMTSEntries.add(objMTSDay); 
                       
                    }
                    system.debug('lstOfVersioningMTSEntries======@@@@==========='+lstOfVersioningMTSEntries);
                }
                
                init();
            }
            else{
                selectedVersionTimesheetEntries();
            }    
        }
        getApprovalHistory();
    }
    //   End Constractor
    public List<Approval_Review__c> getApprovalHistory(){
        return [select Id,Monthly_Timesheet__c,Approval_Type__c,CreatedDate,Name,Reviewer_Name__c,Reviewer_Comments__c,Reviewer_Name__r.Title,Reviewer_Name__r.FirstName,Reviewer_Name__r.LastName,Reviewer_Title__c,Reviewer_Decision__c from Approval_Review__c where Monthly_Timesheet__c=:objMonthlyTimeSheet.id Order By CreatedDate DESC];
    }
    //Get dynamic MT Version value on MonthlyTimesheet object.
    public List<SelectOption> getMtVersion() {
        List<SelectOption> versions = new List<SelectOption>();   
        if(objMonthlyTimeSheet.MTSDV__c != null){
            for(integer i=0;i<=objMonthlyTimeSheet.MTSDV__c;i++){
                versions.add(new SelectOption(string.valueOf(i),string.valueOf(i)));
            }       
        }
        return versions;
    }
    public void selectedVersionTimesheetEntries(){
        
        if(Integer.valueOf(selectedversions) < objMonthlyTimeSheet.MTSDV__c){
                disableSubmittedToHr = true;            
        }
        else
            disableSubmittedToHr = false; 
        
        if(selectedversions != null){
            lstOfVersioningMTSEntries.clear();
            Integer SelectedVersionOnPage = Integer.valueOf(selectedversions);
            system.debug('selectedversions MTS '+objMonthlyTimeSheet.MTSDV__c);
            system.debug('selectedversions'+selectedversions);
            system.debug('SelectedVersionOnPage'+SelectedVersionOnPage);
            list<MTS_Days__c> listOfMTSDay = new list<MTS_Days__c>();
            Set<Date> listOfTimeEntryDate = new Set<Date>();
            
            
            
            for(MTS_Days__c objMTSDay:[select id,(select id,Daily_Timesheet__c,Time_Entry_Date__c from Daily_Time_Entries__r limit 1),DTS_Ids__c,DEH__c,EPD__c,Enrolled__c,Misc_Time__c,MA__c,WC__c,Total_Hours__c,Personal_Leave__c,UNEH__c,
                                       Version__c,MTS_Day__c,NEDEEH__c,EDEEH__c, DEEH__c,Time_Entry_Date__c,Holiday_Leave__c,NEH__c from MTS_Days__c 
                                       where Monthly_Timesheet__c =:objMonthlyTimeSheet.id])
            { 
                if(objMTSDay.Version__c != null && objMTSDay.Version__c == SelectedVersionOnPage){                
                    lstOfVersioningMTSEntries.add(objMTSDay); 
                    listOfTimeEntryDate.add(objMTSDay.Time_Entry_Date__c);                    
                }
                 else if(objMTSDay.Version__c != null && objMTSDay.Version__c < SelectedVersionOnPage 
                        && !listOfTimeEntryDate.contains(objMTSDay.Time_Entry_Date__c))
                    listOfMTSDay.add(objMTSDay);
            } 
            for(MTS_Days__c objMTSDayPerDay:[select id,DEH__c,EPD__c,Enrolled__c,Misc_Time__c,MA__c,WC__c,Total_Hours__c,Personal_Leave__c,UNEH__c,DTS_Ids__c,
                                             Version__c,MTS_Day__c,NEDEEH__c,EDEEH__c,Active__c, DEEH__c,Time_Entry_Date__c,Holiday_Leave__c,NEH__c from MTS_Days__c 
                                             where Id =:listOfMTSDay ORDER BY Version__c DESC])
            {
                if(!listOfTimeEntryDate.contains(objMTSDayPerDay.Time_Entry_Date__c))
                {
                    lstOfVersioningMTSEntries.add(objMTSDayPerDay); 
                    listOfTimeEntryDate.add(objMTSDayPerDay.Time_Entry_Date__c);
                }
            }
            
            init();
        }
        
    }
    public void init(){
        
        if(objMonthlyTimeSheet.id != null){
            
            //Map Prepare to Date Vs Timesheet Entry.
            
            Map<date,list<MTS_Days__c>> mapOfDatesVsMTSEntry = new Map<date,list<MTS_Days__c>>();  
            for(MTS_Days__c objMTSEntry :lstOfVersioningMTSEntries){
                for(Timesheet_Entry__c c:objMTSEntry.Daily_Time_Entries__r){
                    System.debug('objMTSEntry.Daily_Time_Entries__r'+c.Daily_Timesheet__c);
                }
                if(objMTSEntry.Time_Entry_Date__c!= null){
                    if(mapOfDatesVsMTSEntry.get(objMTSEntry.Time_Entry_Date__c) == null){
                        mapOfDatesVsMTSEntry.put(objMTSEntry.Time_Entry_Date__c,new list<MTS_Days__c>());
                        System.debug('objMTSEntry.Daily_Time_Entries__r'+mapOfDatesVsMTSEntry); 
                    }
                    mapOfDatesVsMTSEntry.get(objMTSEntry.Time_Entry_Date__c).add(objMTSEntry);    
                    
                }
                system.debug('mapOfDatesVsMTSEntry-------------------------------'+mapOfDatesVsMTSEntry);
                
            }
            
            
            map<id,list<Medical_Work_Status__c>> mapOfMTSContactIdVsMedicalWorkStatusRecord = new map<id,list<Medical_Work_Status__c>>();
            for(Medical_Work_Status__c eachMedicalWork : [Select id,Workers_Comp__r.Contact_Name__c,Workers_Comp__r.Position__c,Workers_Comp__r.Date_Time_of_Injury__c,Mod_Duty_Start_Date__c,Mod_Duty_End_Date__c,Comp_Off_Work_Start_Date__c,Comp_Off_Work_End_Date__c,Accommodate_Modified_Duty__c from Medical_Work_Status__c where Workers_Comp__r.Contact_Name__c =:objMonthlyTimeSheet.Contact__c AND Workers_Comp__r.Position__c =:objMonthlyTimeSheet.Position__c AND ((Comp_Off_Work_Start_Date__c >=:objMonthlyTimesheet.Pay_Period_Start_Date__c OR Comp_Off_Work_End_Date__c <= :objMonthlyTimesheet.Pay_Period_End_Date__c) OR (Mod_Duty_Start_Date__c >=:objMonthlyTimesheet.Pay_Period_Start_Date__c OR Mod_Duty_End_Date__c <= :objMonthlyTimesheet.Pay_Period_End_Date__c))]){
                system.debug('date of Injury' + eachMedicalWork.Workers_Comp__r.Date_Time_of_Injury__c +'eachMedicalWork '+eachMedicalWork );
                if(eachMedicalWork.Workers_Comp__r.Contact_Name__c != null){
                    if(mapOfMTSContactIdVsMedicalWorkStatusRecord!=null && !mapOfMTSContactIdVsMedicalWorkStatusRecord.containsKey(eachMedicalWork.Workers_Comp__r.Contact_Name__c))
                        mapOfMTSContactIdVsMedicalWorkStatusRecord.put(eachMedicalWork.Workers_Comp__r.Contact_Name__c,new list<Medical_Work_Status__c>());
                    mapOfMTSContactIdVsMedicalWorkStatusRecord.get(eachMedicalWork.Workers_Comp__r.Contact_Name__c).add(eachMedicalWork);
                    system.debug('date of Injury' + eachMedicalWork.Workers_Comp__r.Date_Time_of_Injury__c);
                    dtDateOfInjury = Date.ValueOf(eachMedicalWork.Workers_Comp__r.Date_Time_of_Injury__c);
                }
            }
            
            //End changes done by Eitika on 6/11/2016 for defect: 3690
            list<MTS_Days__c> lstAllMTSEntries = new list<MTS_Days__c>();        
            lstMainWrapper = new list<MainWrapper>();
            list<string> lstOfWeekDay = new list<string>();
            list<string> lstOfDates = new list<string>();
            list<projectWorkedWrapper> lstOfPaidProjectWorkedHours = new list<projectWorkedWrapper>();
            list<projectWorkedWrapper> lstOfProjectWorkedHours = new list<projectWorkedWrapper>();
            list<string> lstOfNEH = new list<string>();
            list<string> lstOfSickLeave = new list<string>();
            list<string> lstOfTotalHours = new list<string>();
            list<string> lstOfNEDEEH = new list<string>();
            list<string> lstOfEDEEH = new list<string>();
            list<string> lstOfVacationLeave = new list<string>();
            list<string> listofMA = new list<string>();
            list<string> listofWC = new list<string>();
            list<string> lstOfPersonalHoliday = new list<string>();
            list<string> lstOfHolidayExcess = new list<string>();
            list<string> lstOfMiscTime = new list<string>();
            list<string> lstOfHoliday = new list<string>();
            list<string> lstOfRDO = new list<string>();
            list<string> lstOfOW = new list<string>();
            list<string> lstOfMD = new list<string>();
            list<string> lstOfNMD = new list<string>();
            string strBlank =' ';
            
            for(Monthly_Timesheet__c objMonthlyTimesheet:[select id ,Contact__c,Pay_Period__r.name,Contact__r.firstname,Contact__r.CCC_ID__c,Contact__r.lastname,Pay_Period_Start_Date__c,Pay_Period_End_Date__c,Position__r.name,Position__r.Position_Effective_Date__c,Position__r.Position_Expiration_Date__c from Monthly_Timesheet__c where id =:objMonthlyTimeSheet.id]){
                
                if(objMonthlyTimesheet.Pay_Period_Start_Date__c != null && objMonthlyTimesheet.Pay_Period_End_Date__c != null){
                    date startDate = objMonthlyTimesheet.Pay_Period_Start_Date__c;
                    date endDate =   objMonthlyTimesheet.Pay_Period_End_Date__c;
                    integer numberDaysDue = startDate.daysBetween(endDate); 
                    list<Datetime> datesl = new list<date>();
                    for(integer j = 1; j<= numberDaysDue + 1; j++){
                        datetime dateInTheRange = startDate.addDays(j);
                        lstOfWeekDay.add(mapOfDaysVsdays.get(dateInTheRange.format('EEEE')));
                        lstOfDates.add(dateInTheRange.format('d'));
                        // system.debug('lstOfDates****::'+lstOfDates);
                        date positioneffdate = objMonthlyTimesheet.Position__r.Position_Effective_Date__c;
                        date positionexpdate = objMonthlyTimesheet.Position__r.Position_Expiration_Date__c;
                        
                    }
                    //changes for defect: 3382 by Eitika Verma on 10/11/2016
                    date payPeriodStartDt = objMonthlyTimesheet.Pay_Period_Start_Date__c;
                    date payPeriodEndDt   = objMonthlyTimesheet.Pay_Period_End_Date__c ;
                    string Paystate       = objMonthlyTimesheet.Pay_Period__r.name;
                    date dateofSt;
                    list<State_Holiday__c> listState = [select id,Date__c,Fiscal_Month__c from State_Holiday__c where Fiscal_Month__r.Name =: Paystate];  
                    date dateD1;
                    list<integer> listdate = new list<integer>();
                    list<string> dateslist = new list<string>();
                    list<integer> Integerlist = new list<integer>();
                    map<Id,list<integer>> maplist = new map<Id,list<integer>>();
                    integer AAA ; 
                    for(State_Holiday__c st:listState){                        
                        dateD1 = st.Date__c;
                        integer DD = date.valueOf(dateD1).Day();
                        listdate.add(DD);
                        dateofSt = st.Date__C;
                        maplist.put(St.Fiscal_Month__c,listdate);
                        AAA = maplist.get(St.Fiscal_Month__c)[0];                        
                    }
                    
                    for(list<integer> ACCM:maplist.values()){ 
                        CCC.addAll(ACCM);
                    }
                    
                    while(payPeriodStartDt <= payPeriodEndDt){                      
                        integer p = payPeriodStartDt.Day();
                        system.debug('payPeriodStartDt.Day() ++:::'+p);
                        // if(payPeriodStartDt.Day() !=AAA){
                        if(!CCC.contains(p)){
                            system.debug('mapOfDatesVsMTSEntry :::'+mapOfDatesVsMTSEntry);
                            mapOfDateVsStateHoliday.put(String.valueOf(payPeriodStartDt.Day()),'null');
                            if(mapOfDatesVsMTSEntry!=null && mapOfDatesVsMTSEntry.size()>0 && mapOfDatesVsMTSEntry.containsKey(payPeriodStartDt) && mapOfDatesVsMTSEntry.get(payPeriodStartDt).size()>0){
                                List<String> ss = String.valueOf(mapOfDatesVsMTSEntry.get(payPeriodStartDt)[0].DTS_Ids__c).split(', ');
                                System.debug(ss+'--'+ss.size());
                                mapOfDateVsStateHoliday.put(String.valueOf(payPeriodStartDt.Day()),ss[0]);
                            }
                            system.debug('mapOfDateVsStateHoliday:::'+mapOfDateVsStateHoliday);
                            mapOfDateVsStateHoliday1.put(String.valueOf(payPeriodStartDt.Day()),'null');
                            mapOfDateVsStateHoliday2.put(String.valueOf(payPeriodStartDt.Day()),'null');
                            payPeriodStartDt = payPeriodStartDt.addDays(1);
                        }                      
                        //else if(payPeriodStartDt.Day() == AAA){
                        else if(CCC.contains(p)){
                            system.debug('mapOfDateVsStateHoliday:::'+payPeriodStartDt.Day());
                            mapOfDateVsStateHoliday.put(String.valueOf(payPeriodStartDt.Day()),'null');   
                            mapOfDateVsStateHoliday1.put(String.valueOf(payPeriodStartDt.Day()),'null'); 
                            mapOfDateVsStateHoliday2.put(String.valueOf(payPeriodStartDt.Day()),'null');                       
                            if(mapOfDatesVsMTSEntry!=null && mapOfDatesVsMTSEntry.size()>0 && mapOfDatesVsMTSEntry.containsKey(payPeriodStartDt) && mapOfDatesVsMTSEntry.get(payPeriodStartDt).size()>0){
                                mapOfDateVsStateHoliday.put(String.valueOf(payPeriodStartDt.Day()),String.valueOf(mapOfDatesVsMTSEntry.get(payPeriodStartDt)[0].DTS_Ids__c));  
                                mapOfDateVsStateHoliday2.put(String.valueOf(payPeriodStartDt.Day()),String.valueOf(mapOfDatesVsMTSEntry.get(payPeriodStartDt)[0].DTS_Ids__c));                      
                            }
                            else if(mapOfDatesVsMTSEntry!=null && mapOfDatesVsMTSEntry.size()>0 && !mapOfDatesVsMTSEntry.containsKey(payPeriodStartDt)){
                                mapOfDateVsStateHoliday1.put(String.valueOf(payPeriodStartDt.Day()),'Test'); 
                            }
                            payPeriodStartDt = payPeriodStartDt.addDays(1); 
                            
                        }         
                    }                    
                    system.debug('mapOfDayVsDailyTimesheetId=========== '+mapOfDateVsStateHoliday1);
                    TotalNEH = 0;
                    TotalTotalHours =0;
                    TotalUNEH  = 0;
                    TotalHolidays = 0;
                    TotalSickLeave = 0;
                    TotalVacationLeave = 0;
                    TotaldecDEEH =0;
                    TotaldecEDEEH =0;
                    TotalHolidayExcess = 0;
                    TotalPersonalHoliday = 0;
                    string strOW = '';
                    string strMD = '';
                    string strNMD = '';
                    
                    for(integer j = 0; j<= numberDaysDue; j++){
                        
                        projectWorkedWrapper objProjectWorkedWrap = new  projectWorkedWrapper();
                        projectWorkedWrapper objPaidProjectWorkedWrap = new  projectWorkedWrapper();
                        if(mapOfDatesVsMTSEntry.size()>0 && mapOfDatesVsMTSEntry!= null){
                            if(mapOfDatesVsMTSEntry.get(startDate.addDays(j)) != null){
                                lstAllMTSEntries =  mapOfDatesVsMTSEntry.get(startDate.addDays(j));
                                string MedicalAbsence;
                                string WorkerComp; 
                                string totalHours;
                                string decProjectWorkedHours;
                                string decNEH;
                                decimal decPaidProjectWorkedHours;
                                string decSickLeave;
                                string decVacationLeave;
                                string decPersonalHoliday;
                                string decMiscTime;
                                decimal decPersonalLeave;
                                string decHolidayExcess;
                                string decDEEH;
                                string decEDEEH;
                                string strEnrolled;
                                string OW;
                                string MD;
                                string NMD;
                                for(MTS_Days__c objMTS :lstAllMTSEntries ){  
                                    
                                    MedicalAbsence = objMTS.MA__c;                        
                                    WorkerComp = objMTS.WC__c; 
                                    decMiscTime =  objMTS.Misc_Time__c;
                                    if(WorkerComp  == 'OW'){  
                                        OW = 'OW';                                  
                                    }
                                    else if(WorkerComp == 'MD'){ 
                                        MD = 'MD';                                    
                                    }
                                    else if(WorkerComp == 'NMD'){ 
                                        NMD = 'NMD';                                    
                                    }
                                    else if(WorkerComp  == 'OW;MD;NMD'){  
                                        OW = 'OW';  
                                        MD = 'MD';
                                        NMD = 'NMD';                                  
                                    }
                                    else if(WorkerComp  == 'OW;MD'){  
                                        OW = 'OW';  
                                        MD = 'MD';                                  
                                    }
                                    else if(WorkerComp  == 'MD;NMD'){ 
                                        MD = 'MD';
                                        NMD = 'NMD';                                  
                                    }
                                    else if(WorkerComp  == 'OW;NMD'){  
                                        OW = 'OW'; 
                                        NMD = 'NMD';                                  
                                    }
                                    else{
                                        OW = ' ';  
                                        MD = ' ';
                                        NMD = ' ';                                     
                                    }
                                    
                                    if(objMTS.Total_Hours__c != null){                               
                                        if(totalHours == null){
                                            totalHours = '';
                                        }
                                        totalHours = totalHours + String.format(objMTS.Total_Hours__c.format(), args); 
                                        TotalTotalHours = TotalTotalHours + decimal.valueof(String.format(objMTS.Total_Hours__c.format(), args));
                                    }                               
                                    if(objMTS.NEH__c!= null){
                                        if(decNEH == null){
                                            decNEH = '';
                                        }
                                        decNEH = decNEH + String.format(objMTS.NEH__c.format(), args);                                   
                                        TotalNEH = TotalNEH + decimal.valueof(String.format(objMTS.NEH__c.format(), args));
                                    }
                                    if(objMTS.UNEH__c!= null){ 
                                        
                                        if(decSickLeave == null){
                                            decSickLeave = '';
                                        }
                                        decSickLeave = decSickLeave + String.format(objMTS.UNEH__c.format(), args);                                    
                                        TotalSickLeave = TotalSickLeave +decimal.valueof(String.format(objMTS.UNEH__c.format(), args));
                                    }
                                    if(objMTS.DEH__c!= null){ 
                                        
                                        if(decVacationLeave == null){
                                            decVacationLeave = '';
                                        }
                                        decVacationLeave = decVacationLeave+  String.format(objMTS.DEH__c.format(), args);                                   
                                        TotalVacationLeave = TotalVacationLeave + decimal.valueof(String.format(objMTS.DEH__c.format(), args));
                                    }
                                    if(objMTS.Personal_Leave__c != null){ 
                                        if(decPersonalHoliday == null){
                                            decPersonalHoliday = '';
                                        }   
                                        decPersonalHoliday = decPersonalHoliday + String.format(objMTS.Personal_Leave__c .format(), args); 
                                        TotalPersonalHoliday =  TotalPersonalHoliday + decimal.valueof(String.format(objMTS.Personal_Leave__c .format(), args));                                       
                                    }
                                    if(objMTS.Holiday_Leave__c != null){ 
                                        if(decHolidayExcess == null){
                                            decHolidayExcess = '';
                                        }    
                                        decHolidayExcess = decHolidayExcess + String.format(objMTS.Holiday_Leave__c .format(), args); 
                                        TotalHolidayExcess = TotalHolidayExcess + decimal.valueof(String.format(objMTS.Holiday_Leave__c .format(), args));                                   
                                    }
                                    
                                    if(objMTS.Enrolled__c == TRUE){   
                                        strEnrolled = 'Yes';                                    
                                    }
                                    if(objMTS.Enrolled__c == FALSE){   
                                        strEnrolled = 'No';                                    
                                    }
                                    if(objMTS.NEDEEH__c != null){ 
                                        
                                        if(decDEEH == null){
                                            decDEEH = '';
                                        }
                                        decDEEH = decDEEH + String.format(objMTS.NEDEEH__c .format(), args);                                    
                                        TotaldecDEEH = TotaldecDEEH + decimal.valueof(String.format(objMTS.NEDEEH__c .format(), args));
                                    }    
                                    if(objMTS.EDEEH__c != null){ 
                                        
                                        if(decEDEEH == null){
                                            decEDEEH = '';
                                        }
                                        decEDEEH = decEDEEH + String.format(objMTS.EDEEH__c .format(), args);                                  
                                        TotaldecEDEEH = TotaldecEDEEH + decimal.valueof(String.format(objMTS.EDEEH__c.format(), args));
                                    }                            
                                    
                                }
                                
                                if(MedicalAbsence != null){
                                    System.debug('---'+MedicalAbsence);
                                    listofMA.add(string.valueOf(MedicalAbsence.split(';')));
                                }else{
                                    listofMA.add(strBlank);
                                }   
                                if(OW == 'OW'){
                                    lstOfOW.add('OW');
                                }else{
                                    lstOfOW.add(strBlank); 
                                } 
                                if(MD == 'MD'){
                                    lstOfMD.add('MD');
                                }else {
                                    lstOfMD.add(strBlank); 
                                } 
                                if(NMD == 'NMD'){
                                    lstOfNMD.add('NMD');
                                }else {
                                    lstOfNMD.add(strBlank); 
                                } 
                                if(totalHours != null){
                                    objProjectWorkedWrap.projectWorked = string.valueOf(totalHours);
                                    objProjectWorkedWrap.projectTimesheetDate = string.valueOf(startDate.addDays(j));
                                    lstOfProjectWorkedHours.add(objProjectWorkedWrap);
                                    lstOfTotalHours.add(string.valueOf(totalHours));
                                }
                                else{ 
                                    objProjectWorkedWrap.projectWorked = string.valueOf(totalHours);                           
                                    lstOfProjectWorkedHours.add(objProjectWorkedWrap);
                                    lstOfTotalHours.add(strBlank);
                                }
                                if(decNEH != null){
                                    lstOfNEH.add(string.valueOf(decNEH));
                                } 
                                else{ 
                                    lstOfNEH.add(strBlank);                            
                                }
                                if(decSickLeave != null){
                                    lstOfSickLeave.add(string.valueOf(decSickLeave));
                                }else{
                                    lstOfSickLeave.add(strBlank);
                                }
                                if(decVacationLeave != null){
                                    lstOfVacationLeave.add(string.valueOf(decVacationLeave));
                                }else{
                                    lstOfVacationLeave.add(strBlank);
                                }                            
                                if(decPersonalHoliday != null){
                                    lstOfPersonalHoliday.add(string.valueOf(decPersonalHoliday));
                                    
                                }else{
                                    lstOfPersonalHoliday.add(strBlank); 
                                }
                                if(decHolidayExcess != null){
                                    lstOfHolidayExcess.add(string.valueOf(decHolidayExcess));
                                }else{
                                    lstOfHolidayExcess.add(strBlank); 
                                }
                                if(decMiscTime != null){
                                    lstOfMiscTime.add(string.valueOf(decMiscTime.split(';')));
                                }else{
                                    lstOfMiscTime.add(strBlank);
                                } 
                                if(strEnrolled == 'Yes'){
                                    lstOfRDO.add('Yes');
                                }else if(strEnrolled == 'No'){
                                    lstOfRDO.add('No'); 
                                } 
                                
                                if(decDEEH!= null){
                                    lstOfNEDEEH.add(string.valueOf(decDEEH));
                                }
                                else{
                                    lstOfNEDEEH.add(strBlank);
                                }
                                if(decEDEEH!= null){
                                    lstOfEDEEH.add(string.valueOf(decEDEEH));
                                }
                                else{
                                    lstOfEDEEH.add(strBlank);
                                }
                                
                            }else{                               
                                lstOfProjectWorkedHours.add(objProjectWorkedWrap);
                                lstOfNEH.add(strBlank);
                                lstOfSickLeave.add(strBlank);
                                lstOfVacationLeave.add(strBlank);
                                lstOfPersonalHoliday.add(strBlank);
                                lstOfHolidayExcess.add(strBlank); 
                                lstOfMiscTime.add(strBlank);
                                lstOfRDO.add(strBlank); 
                                listofMA.add(strBlank);
                                listofWC.add(strBlank);
                                lstOfTotalHours.add(strBlank);
                                lstOfNEDEEH.add(strBlank);
                                lstOfEDEEH.add(strBlank);
                                lstOfOW.add(strBlank);
                                lstOfMD.add(strBlank);
                                lstOfNMD.add(strBlank);
                            }
                            
                            
                        }
                        
                    }
                    
                }
                system.debug('lstOfWeekDay======================='+lstOfWeekDay.size());
                lstMainWrapper.add(new MainWrapper(objMonthlyTimesheet,lstOfWeekDay,lstOfDates,listofMA,listofWC,lstOfTotalHours,lstOfPaidProjectWorkedHours,lstOfProjectWorkedHours,lstOfNEH,lstOfSickLeave,lstOfMiscTime,lstOfVacationLeave,lstOfPersonalHoliday,lstOfHolidayExcess,lstOfNEDEEH,lstOfEDEEH,lstOfHoliday,lstOfRDO,lstOfOW,lstOfMD,lstOfNMD));
                system.debug('lstlstMainWrapper========================'+lstMainWrapper);
            }
            
            //Submitted to HR button visiblity only profile 1 , 2 & 3.
            //Extracting Profile Name of Logged in User
            system.debug('objMonthlyTimeSheet444=================>'+objProfile.Name);
            if(objProfile != null){
                if(!strViewVersion.contains('false')){
                    if(objProfile.Name == label.C3_Profile_1 || objProfile.Name == label.C3_Profile_2 || objProfile.Name == label.C3_Profile_3){
                        IsCheckSubmittedToHr = true;
                    }
                    //Submit to SCO and Reject Button visibility only profile 4
                    if(objProfile.Name == label.C3_Profile_4){
                        IsCheckSCOAndReject = true;
                        //IsCheckFinalSCO = true;
                        //disableFinalSubmitToSCO = true;
                    }
                    if(objProfile.Name == label.C3_Profile_4 || objProfile.Name == label.C3_Profile_3){
                        IsStipendEnable = true;
                    }
                    //Send to Docusign button Visibility for Profile 1,2,3 & 4.
                    if(objProfile.Name == label.C3_Profile_1 || objProfile.Name == label.C3_Profile_2 || objProfile.Name == label.C3_Profile_3 || objProfile.Name == label.C3_Profile_4){
                        IsCheckSendDocuSign = true; 
                    }    
                }
            }
            
        }
    }
    
    
    
    
    //Define Wrapper Class to Monthly Timesheet Object.
    public class MainWrapper{
        public Monthly_Timesheet__c objMonthlyTimesheet {get;set;}
        public list<string> lstOfDays {get;set;}
        public list<string> lstOfdates {get;set;}
        public list<projectWorkedWrapper> lstOfPaidProjectWorked {get;set;}
        public list<projectWorkedWrapper> lstOfProjectWorked {get;set;}
        public list<string> lstOfNEH {get;set;}
        public list<string> lstOfSickLeave {get;set;}
        public list<string> lstOfMiscTime {get;set;}
        public list<string> lstOfNEDEEH {get;set;}
        public list<string> lstOfEDEEH {get;set;}
        public list<string> lstOfVacationLeave {get;set;}
        public list<string> listofMA {get;set;}
        public list<string> listofWC {get;set;}
        public list<string> lstOfPersonalHoliday {get;set;}
        public list<string> lstOfHolidayExcess {get;set;}
        public list<string> lstOfHoliday {get;set;}
        public list<string> lstOfRDO {get;set;}
        public list<string> lstOfOW {get;set;}
        public list<string> lstOfMD {get;set;}
        public list<string> lstOfNMD {get;set;}
        
        public MainWrapper(Monthly_Timesheet__c obj,list<string> Days,list<string> dates,list<string> medicalabsence,list<string> WorkerComp,list<string> hoursOfTotal,list<projectWorkedWrapper> PaidProjectHours,list<projectWorkedWrapper> ProjectHours,list<string> NEHhours,list<string> Sickleave,list<string> MiscTime,list<string> Vacationleave,list<string> PersonalHoliday,list<string> HolidayExcess,list<string> DEEHHours,list<string> EDEEHHours,list<string> Holiday,list<string> RDO,list<string> OW,list<string> MD,list<string> NMD){
            this.objMonthlyTimesheet = obj;
            this.lstOfDays = Days;
            this.lstOfdates = dates;        
            this.listofMA = medicalabsence;
            this.listofWC = WorkerComp;
            this.lstOfPaidProjectWorked = PaidProjectHours;
            this.lstOfProjectWorked = ProjectHours;
            this.lstOfNEH = NEHhours;
            this.lstOfSickLeave = Sickleave;
            this.lstOfMiscTime = MiscTime;
            this.lstOfVacationLeave = Vacationleave;
            this.lstOfPersonalHoliday = PersonalHoliday;
            this.lstOfHolidayExcess = HolidayExcess;
            this.lstOfNEDEEH = DEEHHours;
            this.lstOfEDEEH = EDEEHHours;
            this.lstOfHoliday = Holiday;
            this.lstOfRDO = RDO;
            this.lstOfOW = OW;
            this.lstOfMD = MD;
            this.lstOfNMD = NMD;
        }
        
    }
    public class projectWorkedWrapper {
        public string projectWorked {get;set;}
        public string projectTimesheetDate {get;set;}
    }
    public void getTimesheetIds(){
        System.debug('selectedversions11111--------------'+selectedversions);
       set <string> lstofDTSversion = new set<string>();
        if(!Test.isRunningTest()){
            strDailyTimesheetDate =  Apexpages.currentPage().getParameters().get('strDialyTimesheetDate');
            Date DateOfTE = date.valueof(strDailyTimesheetDate);
            system.debug('strDailyTimesheetDate------------------'+DateOfTE );
        }
        lstOfWrapperPopup = new list<mainWrapperPopup>();
        mlstOfWrapperPopup = new list<mainWrapperPopup1>();
        llstOfWrapperPopup = new list<mainWrapperPopup2>();
        list<mainWrapperPopup> lstOfWrapperPopupP = new list<mainWrapperPopup>();
        list<mainWrapperPopup1> lstOfWrapperPopupM = new list<mainWrapperPopup1>();
        list<mainWrapperPopup2> lstOfWrapperPopupL = new list<mainWrapperPopup2>();
        lstOfWrapperPopup = new list<mainWrapperPopup>();
        Id recordTypeIdProjectTime = C3Common.GetRecordTypeId('Timesheet_Entry__c','Project Time Entry');
        Id recordTypeIdLeaveType = C3Common.GetRecordTypeId('Timesheet_Entry__c','Leave Time Entry');
        Id recordTypeMiscellaneous = C3Common.GetRecordTypeId('Timesheet_Entry__c','Miscellaneous Time Entry');
        TotalHours = 0.0;
        TotalPaidHours = 0.0;
        list<Timesheet_Entry__c> lstOfClickingAllTimesheetEntries = new list<Timesheet_Entry__c>();
        list<Timesheet_Entry__c> lstOfClickingAllTimesheetEntries1 = new list<Timesheet_Entry__c>();
        if(selectedversions == null){
            System.debug('selectedversions11111--------------'+selectedversions);
            //Default View version monthlyTimesheet.
            lstOfClickingAllTimesheetEntries =   [select id,name,Jury_Duty__c,Suspended__c,RDO__c,Holiday__c,Pregnancy__c,FMLA__c,CRFA__c,AWOL__c,Dock__c,Used_CTO__c,Used_Holiday_Excess__c,Used_Personal_Leave__c,Used_Military_Leave__c,Used_Personal_Holiday__c,Used_Vacation__c,Used_Sick__c,Daily_Timesheet__r.Time_Entry_Date__c,Project_Worked_Hours__c,Daily_Timesheet_Project__r.Project_Name__r.name,
                                                  Daily_Timesheet_Project__r.Project_Name__r.Project_Package_Type__r.Name,Daily_Timesheet_Project__r.Project_Name__r.Project_Package_Type__r.Project_Type_Category__c,Daily_Timesheet_Project__r.Project_Name__r.Project_Number__c,recordtypeId,Personal_Leave_Credit_Used__c,Holiday_Leave_Credit_Used__c,Miscellaneous__c,Medical_Absence__c 
                                                  from Timesheet_Entry__c where Monthly_Timesheet__c =:objMonthlyTimeSheet.id ];
        }else{
            
            Map<Date,Id> lstMTSDays = new Map<Date,Id>();
            for(MTS_Days__c mtsDay : [select id,Version__c, Time_Entry_Date__c from MTS_Days__c where Monthly_Timesheet__c =: objMonthlyTimeSheet.id  and Version__c <=: Decimal.valueOf(selectedversions)  order by Version__c desc]){
                if(!lstMTSDays.containsKey(mtsDay.Time_Entry_Date__c)){
                                    lstMTSDays.put(mtsDay.Time_Entry_Date__c,mtsDay.id);

                }
            }            
            Map<Date,List<Timesheet_Entry__c>> mapof = new Map<Date,List<Timesheet_Entry__c>>();
    for(Timesheet_Entry__c   objtimesheetEntries : [select id,Version__c,
                                                    DTS_Version__c,name,Jury_Duty__c,Suspended__c,
                                                    RDO__c,Holiday__c,Pregnancy__c,FMLA__c,
                                                    CRFA__c,AWOL__c,Dock__c,Used_CTO__c,
                                                    Used_Holiday_Excess__c,Used_Personal_Leave__c,
                                                    Used_Military_Leave__c,Used_Personal_Holiday__c,
                                                    Used_Vacation__c,Used_Sick__c,Daily_Timesheet__r.Time_Entry_Date__c,
                                                    Project_Worked_Hours__c,Daily_Timesheet_Project__r.Project_Name__r.name,Daily_Timesheet_Project__r.Project_Name__r.Project_Package_Type__r.Name,
                                                    Daily_Timesheet_Project__r.Project_Name__r.Project_Package_Type__r.Project_Type_Category__c,Daily_Timesheet_Project__r.Project_Name__r.Project_Number__c,
                                                    recordtypeId,Personal_Leave_Credit_Used__c,Time_Entry_Date__c,
                                                    Holiday_Leave_Credit_Used__c,Miscellaneous__c,Medical_Absence__c 
                                                    from Timesheet_Entry__c where Monthly_Timesheet__c =: objMonthlyTimeSheet.id 
                                                    AND Daily_Timesheet__r.Time_Entry_Date__c =: date.valueof(strDailyTimesheetDate) 
                                                    AND MTS_Day__c in : lstMTSDays.values() order by DTS_Version__c asc] )
                                                    {                    
                                                       
                lstOfClickingAllTimesheetEntries.add(objtimesheetEntries);
}
            System.debug('--'+lstOfClickingAllTimesheetEntries);
            for(Timesheet_Entry__c   objtimesheetEntries : lstOfClickingAllTimesheetEntries){
                system.debug('objtimesheetEntries version:::'+objtimesheetEntries.DTS_Version__c);
                lstOfClickingAllTimesheetEntries1.add(objtimesheetEntries);
            }
        }
        if(lstOfClickingAllTimesheetEntries1.size()>0){  
            for(Timesheet_Entry__c objTimesheet:lstOfClickingAllTimesheetEntries1){
                if(string.valueOf(objTimesheet.Daily_Timesheet__r.Time_Entry_Date__c) == strDailyTimesheetDate){                    
                    mainWrapperPopup objWrapperPopup = new mainWrapperPopup();
                    //get Project Hours
                    system.debug('objTimesheet.Project_Worked_Hours__c:::'+objTimesheet.Project_Worked_Hours__c +'****'+objTimesheet.recordtypeId +'=='+ recordTypeIdProjectTime +'Project Name'+objTimesheet.Daily_Timesheet_Project__r.Project_Name__r.name +'strDailyTimesheetDate::date:'+strDailyTimesheetDate);
                    if(objTimesheet.Project_Worked_Hours__c != null && objTimesheet.recordtypeId == recordTypeIdProjectTime){
                        objWrapperPopup.ProjectName = objTimesheet.Daily_Timesheet_Project__r.Project_Name__r.name;
                        objWrapperPopup.ProjectType = objTimesheet.Daily_Timesheet_Project__r.Project_Name__r.Project_Package_Type__r.Name;
                        objWrapperPopup.ProjectNumber = objTimesheet.Daily_Timesheet_Project__r.Project_Name__r.Project_Number__c;
                        objWrapperPopup.ProjectHours = string.valueOf(objTimesheet.Project_Worked_Hours__c);
                        objWrapperPopup.LeaveEntry = '-';
                        objWrapperPopup.HolidayLeaveEntry = '-';
                        if(string.valueOf(objTimesheet.Miscellaneous__c) != null)
                            objWrapperPopup.Miscellaneous = string.valueOf(objTimesheet.Miscellaneous__c).replaceAll(';', ',');
                        if(string.valueOf(objTimesheet.Medical_Absence__c) != null)
                            objWrapperPopup.MedicalAbsence = string.valueOf(objTimesheet.Medical_Absence__c).replaceAll(';', ',');
                        TotalHours = TotalHours + objTimesheet.Project_Worked_Hours__c;
                        lstOfWrapperPopupP.add(objWrapperPopup);
                        system.debug('******Total Hours******: '+TotalHours );
                    }                    
                    timesheetEntryDate = objTimesheet.Daily_Timesheet__r.Time_Entry_Date__c;  
                    if(objTimesheet.Project_Worked_Hours__c == null && objTimesheet.recordtypeId == recordTypeMiscellaneous){
                        mainWrapperPopup1 objWrapperPaidHoursPopup1 = new mainWrapperPopup1();
                        objWrapperPaidHoursPopup1.ProjectName = '-';
                        objWrapperPaidHoursPopup1.ProjectType = '-';
                        objWrapperPaidHoursPopup1.ProjectNumber = '-';
                        objWrapperPaidHoursPopup1.ProjectHours = '-';
                        objWrapperPaidHoursPopup1.LeaveEntry = '-';
                        objWrapperPaidHoursPopup1.HolidayLeaveEntry = '-';
                        if(string.valueOf(objTimesheet.Miscellaneous__c) != null)
                            objWrapperPaidHoursPopup1.Miscellaneous = string.valueOf(objTimesheet.Miscellaneous__c).replaceAll(';', ',');
                        if(string.valueOf(objTimesheet.Medical_Absence__c) != null)
                            objWrapperPaidHoursPopup1.MedicalAbsence = string.valueOf(objTimesheet.Medical_Absence__c).replaceAll(';', ',');
                        TotalHours = TotalHours;
                        lstOfWrapperPopupM.add(objWrapperPaidHoursPopup1);
                    }
                    if(objTimesheet.Project_Worked_Hours__c == null && objTimesheet.recordtypeId == recordTypeIdLeaveType){
                        mainWrapperPopup2 objWrapperPaidHoursPopup2 = new mainWrapperPopup2();
                        objWrapperPaidHoursPopup2.ProjectName = '-';
                        objWrapperPaidHoursPopup2.ProjectType = '-';
                        objWrapperPaidHoursPopup2.ProjectNumber = '-';
                        objWrapperPaidHoursPopup2.ProjectHours = '-';
                        objWrapperPaidHoursPopup2.LeaveEntry = string.valueOf(objTimesheet.Personal_Leave_Credit_Used__c);
                        objWrapperPaidHoursPopup2.HolidayLeaveEntry = string.valueOf(objTimesheet.Holiday_Leave_Credit_Used__c);
                        if(string.valueOf(objTimesheet.Miscellaneous__c) != null)
                            objWrapperPaidHoursPopup2.Miscellaneous = '-';
                        if(string.valueOf(objTimesheet.Medical_Absence__c) != null)
                            objWrapperPaidHoursPopup2.MedicalAbsence = '-';
                        TotalHours = TotalHours;
                        lstOfWrapperPopupL.add(objWrapperPaidHoursPopup2);
                    }
                }
                
            }
        }
        else{
            system.debug('hai');
            TotalHours = 0.0;  
            timesheetEntryDate = date.valueOf(strDailyTimesheetDate); 
        }
        
        for(mainWrapperPopup objwrap:lstOfWrapperPopupP){
            lstOfWrapperPopup.add(objwrap);
        }
        
        for(mainWrapperPopup1 objwrap:lstOfWrapperPopupM){
            mlstOfWrapperPopup.add(objwrap);
        }
        for(mainWrapperPopup2 objwrap:lstOfWrapperPopupL){
            llstOfWrapperPopup.add(objwrap);
        }  
    }
    
    
    public class mainWrapperPopup{
        public string timeEntryType {get;set;}
        public string ProjectName {get;set;}
        public string ProjectType {get;set;}
        public string ProjectNumber {get;set;}
        public string ProjectHours {get;set;}
        public string LeaveHours {get;set;}
        public string LeaveEntry {get;set;}
        public string HolidayLeaveEntry {get;set;}
        public string Miscellaneous {get;set;}
        public string MedicalAbsence {get;set;}
        
    }
    public class mainWrapperPopup1{
        public string timeEntryType {get;set;}
        public string ProjectName {get;set;}
        public string ProjectType {get;set;}
        public string ProjectNumber {get;set;}
        public string ProjectHours {get;set;}
        public string LeaveHours {get;set;}
        public string LeaveEntry {get;set;}
        public string HolidayLeaveEntry {get;set;}
        public string Miscellaneous {get;set;}
        public string MedicalAbsence {get;set;}
        
    }
    public class mainWrapperPopup2{
        public string timeEntryType {get;set;}
        public string ProjectName {get;set;}
        public string ProjectType {get;set;}
        public string ProjectNumber {get;set;}
        public string ProjectHours {get;set;}
        public string LeaveHours {get;set;}
        public string LeaveEntry {get;set;}
        public string HolidayLeaveEntry {get;set;}
        public string Miscellaneous {get;set;}
        public string MedicalAbsence {get;set;}
        
    }
    
    public pagereference viewMonthlyTimesheetPdf(){
        return new pagereference('/apex/monthlyTimesheetViewPdf_Stipend?id='+objMonthlyTimeSheet.id);
    }
    
    
    // Submit to HR
    
    public Void submittedtoHR(){
            MTSStatus = objMonthlyTimeSheet.Monthly_Timesheet_Status__c ;
        sizelistName.clear();
        Monthly_Timesheet__c monthlyTime = [select id,Name,Monthly_Timesheet_Status__c,Pay_Period_Start_Date__c,Position__c from Monthly_Timesheet__c where id =:strMonthlyTimesheetId];
        
        
        list<Monthly_Timesheet__c> allmonthlylist = [select id,Name,Monthly_Timesheet_Status__c,Position__c,Pay_Period_Start_Date__c from Monthly_Timesheet__c where Position__c =: monthlyTime.Position__c And Pay_Period_End_Date__c < :monthlyTime.Pay_Period_Start_Date__c and Monthly_Timesheet_Status__c NOT IN ('Submitted to HR','Manually Keyed','Ready For SCO','Submitted to SCO')];
                 system.debug(allmonthlylist+'sizelist'+sizelist.size());
        
        if(allmonthlylist.size() > 0){
        for(Monthly_Timesheet__c MTST :allmonthlylist){            
            if(MTST.Pay_Period_Start_Date__c < monthlyTime.Pay_Period_Start_Date__c){
                sizelist.add(MTST); 
                system.debug('sizelist'+sizelist);
                sizelistName.add(MTST.Name); 
            }
         }  
        }    
        if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Submitted to HR' && objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Ready For SCO' && objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Submitted to SCO' && sizelist.size() == 0 ){
           
            //Get Individual daily hours exceed 24 hours.
            lstOfErrorMessages = clsTimeSheetApprovalValidations.exceeding24Hours(objMonthlyTimeSheet.id);
            
            //Get to the date that time is posted to a specific Project is not within the Project Term Start Date and Project Term End Date.
            list<String> lstOfErrorMessage1 = new list<String>();
            lstOfErrorMessage1 = clsTimeSheetApprovalValidations.dailyTimeSheetDatedoesnotExistProjectStartDateEndDate(objMonthlyTimeSheet.id);
            lstOfErrorMessages.addall(lstOfErrorMessage1);
            
            //Get One of more days within the transaction position startdate and enddate for the Monthly Timesheet have entries to Time Sheet Entry Date.
            if(objMonthlyTimeSheet.Position__c != null){
                list<String> lstOfErrorMessage2 = new list<String>();
                //If Transaction Position Start Date & End Dates are between Pay Period Start Date & End Date or equals then pass transaction Position Start Date & End Date.
                if(objMonthlyTimeSheet.Pay_Period_Start_Date__c < = objMonthlyTimeSheet.Position__r.Position_Effective_Date__c && objMonthlyTimeSheet.Pay_Period_End_Date__c >= objMonthlyTimeSheet.Position__r.Position_Expiration_Date__c){
                    lstOfErrorMessage2 = clsTimeSheetApprovalValidations.timesheetDoesNotExistForDate(objMonthlyTimeSheet.id ,objMonthlyTimeSheet.Position__r.Position_Effective_Date__c,objMonthlyTimeSheet.Position__r.Position_Expiration_Date__c);
                    System.debug('lstOfErrorMessageslstOfErrorMessage2=====================>'+lstOfErrorMessage2);
                }
                //if Monthly timesheet Pay period start Date & End Date are between Transaction Positionn Start Date & End Dates or equals then pass Monthly pay period start date and end date.
                else if(objMonthlyTimeSheet.Pay_Period_Start_Date__c >=objMonthlyTimeSheet.Position__r.Position_Effective_Date__c && objMonthlyTimeSheet.Pay_Period_End_Date__c<=objMonthlyTimeSheet.Position__r.Position_Expiration_Date__c){
                    
                    
                    lstOfErrorMessage2 = clsTimeSheetApprovalValidations.timesheetDoesNotExistForDate(objMonthlyTimeSheet.id ,objMonthlyTimeSheet.Pay_Period_Start_Date__c,objMonthlyTimeSheet.Pay_Period_End_Date__c);
                    System.debug('lstOfErrorMessages=====================>'+lstOfErrorMessage2);
                }
                //if transaction position start date are like to Monthly pay period Start date and End date then transaction Position start date and monthly pay period end date.
                else if(objMonthlyTimeSheet.Position__r.Position_Effective_Date__c >= objMonthlyTimeSheet.Pay_Period_Start_Date__c && objMonthlyTimeSheet.Position__r.Position_Effective_Date__c<=objMonthlyTimeSheet.Pay_Period_End_Date__c){                                                                    
                    lstOfErrorMessage2 = clsTimeSheetApprovalValidations.timesheetDoesNotExistForDate(objMonthlyTimeSheet.id ,objMonthlyTimeSheet.Position__r.Position_Effective_Date__c,objMonthlyTimeSheet.Pay_Period_End_Date__c);           
                }
                //if transaction position end date are like to Monthly pay period Start date and End date then monthly pay period start date and transaction position end date.
                else if(objMonthlyTimeSheet.Position__r.Position_Expiration_Date__c>= objMonthlyTimeSheet.Pay_Period_Start_Date__c && objMonthlyTimeSheet.Position__r.Position_Expiration_Date__c<=objMonthlyTimeSheet.Pay_Period_End_Date__c){
                    lstOfErrorMessage2 = clsTimeSheetApprovalValidations.timesheetDoesNotExistForDate(objMonthlyTimeSheet.id ,objMonthlyTimeSheet.Pay_Period_Start_Date__c,objMonthlyTimeSheet.Position__r.Position_Expiration_Date__c);
                }
                lstOfErrorMessages.addall(lstOfErrorMessage2);
            }
            
            //Get exceeding Available leave hours(Pay period leave balance) from Monthly timesheet total leave hours.
            list<String> lstOfErrorMessage3 = new list<String>();
            lstOfErrorMessage3 = clsTimeSheetApprovalValidations.exceedingAvailbleLeaveHours(objMonthlyTimeSheet.id ,objMonthlyTimeSheet.Pay_Period_Start_Date__c,objMonthlyTimeSheet.Pay_Period_End_Date__c,objMonthlyTimeSheet.Position__r.Worker_Type__c,objMonthlyTimeSheet.Contact__c);
            lstOfErrorMessages.addall(lstOfErrorMessage3);
            
            
            if(lstOfErrorMessages.size() == 0){
                
                //Get Approval already in Process on monthlytimesheetId.
                Id workItemId = getWorkItemId(objMonthlyTimeSheet.id); 
                if(workItemId != null){
                    ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.ERROR,'This record is currently in an approval process.');
                    ApexPages.addMessage(myMsg); 
                    return ;
                }else{
                    // Create an approval request for the Monthly TimeSheet Object
                    Approval.ProcessSubmitRequest req1 = new Approval.ProcessSubmitRequest();
                    //req1.setComments(strComments);
                    req1.setObjectId(objMonthlyTimeSheet.id);
                    
                    // Submit on behalf of a specific submitter
                    req1.setSubmitterId(UserInfo.getUserId());
                    req1.setProcessDefinitionNameOrId('Monthly_Timesheet_to_HR_Queue');
                    
                    // Submit the approval request for the account
                    Approval.ProcessResult result = Approval.process(req1);
                    System.debug('result=====================>'+result);
                    
                    
                    if(result.isSuccess() == true){
                        //Monthly TimeSheet Status Change to Submitted to HR.
                        objMonthlyTimeSheet.Monthly_Timesheet_Status__c = 'Submitted to HR';
                        try{                            
                            update objMonthlyTimeSheet;
                        }
                        catch(Exception e){
                            //objMonthlyTimeSheet.addError(e.getMessage());
                            ProcessInstanceWorkitem workItems = [SELECT Id, ProcessInstanceId FROM ProcessInstanceWorkitem WHERE ProcessInstance.TargetObjectId = :objMonthlyTimeSheet.id limit 1];
                            List<Approval.ProcessWorkitemRequest> requests = new List<Approval.ProcessWorkitemRequest>();
                            Approval.ProcessWorkitemRequest req = new Approval.ProcessWorkitemRequest();
                            req.setWorkitemId(workItems.Id);
                            //Valid values are: Approve, Reject, or Removed. 
                            //Only system administrators can specify Removed.
                            req.setAction('Removed');
                            //req.setComments('Your Comment.');
                            requests.add(req);
                            Approval.ProcessResult[] processResults = Approval.process(requests);
                            System.debug('Exception:: '+e.getMessage());
                            objMonthlyTimeSheet.Monthly_Timesheet_Status__c = '';
                            return ;
                        }
                        objMonthlyTimeSheet  = [select id,MTSDV__c,MT_Version__c,Contact__c,Contact__r.Unit__r.Name,Position__c,Position__r.Worker_Type__c,Position__r.Position_Effective_Date__c,EEHR__c,
                                                 BSU__c,BSA__c,DD__c,DNE__c,NPCD__c,TEEEH__c,TNEEEH__c,TEET__c,PS__c,
                                                 Position__r.Position_Expiration_Date__c,Monthly_Timesheet_Status__c,Pay_Period_Start_Date__c,Pay_Period_End_Date__c,Submitted_to_SCO_Date__c, 
                                                 Total_Paid_Hours__c,Total_PTO_Hours_Used__c,SU__c,EETB__c,PD__c,DPA__c,EET__c,
                                                 STI_Available_Personal_Leave_Credits__c,STI_Awarded_Personal_Leave_Credits__c,STI_Balance_Personal_Leave_Credits__c,
                                                 STI_Used_Personal_Leave_Credits__c,STI_Personal_Leave_Adjustment__c,NASA__c,DIM__c,EEHM__c,
                                                 TEETBSTSCO__c,TNEETBSTSCO__c,SASTSCO__c,
                                                 STI_Available_Holiday_Leave_Credits__c,STI_Awarded_Holiday_Leave_Credits__c,STI_Balance_Holiday_Leave_Credits__c,STI_Used_Holiday_Leave_Credits__c,STI_Separations_Cashout__c from Monthly_Timesheet__c where id =:strMonthlyTimesheetId limit 1];

                        //Insert record Approval History Object.
                        insertApprovalHistory(objMonthlyTimeSheet.id,'Submitted to HR','');
                        
                        //Button Enable or disable as status condition.
                        disableSubmittedToHr = true;
                        ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.CONFIRM,system.label.Timesheet_has_been_submitted_to_HR);
                        ApexPages.addMessage(myMsg); 
                        return ;
                    }else{
                        return ;
                    }
                }
            }
        }
        else if(sizelist.size()>0){
              system.debug('sizelist 1'+sizelist);
            for(String S : sizelistName){
                ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.ERROR,'The previous pay period MTS should be in Submitted to HR or Manually Keyed or Ready for SCO or Submitted to SCO status: '+ S);
                ApexPages.addMessage(myMsg);
            }
        }
    }
    
    public Id getWorkItemId(Id targetObjectId)
    {
        Id retVal = null;
        
        for(ProcessInstanceWorkitem workItem  : [Select p.Id from ProcessInstanceWorkitem p
                                                 where p.ProcessInstance.TargetObjectId =: targetObjectId])
        {
            retVal  =  workItem.Id;
        }
        
        return retVal;
    }  
    
    //Insert Approval History based on Monthly Timesheet record.
    public void insertApprovalHistory(ID monthlyTimesheetid,string strstatus,string strComments){
        
        Approval_Review__c objAR = new Approval_Review__c();
        objAR.Reviewer_Name__c = Userinfo.getUserId();
        objAR.Reviewer_Comments__c = strComments;
        objAR.Reviewer_Decision__c= strStatus;
        objAR.Monthly_Timesheet__c = monthlyTimesheetid;
        objAR.Approval_Type__c = 'Monthly Timesheet';
        insert objAR;
    }
    
    //This Method Ready for SCO status on Monthly TimeSheet   
    
    public Void submitToSCO(){    
        if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Ready For SCO' && objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Submitted to SCO' && objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Manually Keyed'){
            
            //Checked Currently login User belong to Queues and passed parameter Queue Name.
            boolean IsUserChecked = C3Common.isLoggedInUserInQueueBelongRolesOrUser('HR_Queue');
            system.debug('IsUserChecked---------------->'+IsUserChecked);
            if(IsUserChecked == false){
                ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.ERROR,System.label.You_are_not_authorized_person);
                ApexPages.addMessage(myMsg); 
                return;
            }
            //Update Monthly TimeSheet Status Change to Ready for SCO. 
            objMonthlyTimeSheet.Monthly_Timesheet_Status__c = 'Ready For SCO';
            
            update objMonthlyTimeSheet;
            //Added code to insert Approval review record for fix 4909
            insertApprovalHistory(objMonthlyTimeSheet.id,'Ready For SCO','');
            //Button(Ready for SCO,Reject and Manually keyed) Enable or disable as status condition.
            disableSubmitToSCO = true;  
            disableSubmittedToHr = true;  
            disableManuallyKeyed = true;   
            disableReject = true; 
            ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.CONFIRM,system.label.Timesheet_has_been_Submitted_to_SCO);
            ApexPages.addMessage(myMsg); 
            return ;
        }
    }
    //This Method Manually Keyed status on Monthly TimeSheet   
    
    public void submitToManuallyKeyed(){
        if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Submitted to HR' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Ready For SCO' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c == 'Submitted to SCO' || objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Manually Keyed'){     
            //Update Monthly TimeSheet Status Change to Manually Keyed. 
            objMonthlyTimeSheet.Monthly_Timesheet_Status__c = 'Manually Keyed';
            
            update objMonthlyTimeSheet;
            
            //Button(Ready for SCO,Reject and Manually Keyed) Enable or disable as status condition.
            disableSubmittedToHr = true; 
            disableSubmitToSCO = true;
            disableManuallyKeyed = true;
            disableReject = true;
            ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.CONFIRM,system.label.Timesheet_has_been_Final_Submitted_to_SCO);
            ApexPages.addMessage(myMsg); 
            return ;
        }
    }
    
    //This Method Reject the Monthly TimeSheet
    public void submitToReject()
    {
        //hide versioning monthly timesheet record.
        if(objMonthlyTimeSheet.MT_Version__c > 1)
        {
            IsveiwVersions =  true;
            IsselectionVersion = false;
        } 
        if(objMonthlyTimeSheet.Monthly_Timesheet_Status__c != 'Rejected')
        {
            
            //Checked Currently login User belong to Queues and passed parameter Queue Name.
            boolean IsUserChecked = C3Common.isLoggedInUserInQueueBelongRolesOrUser('HR_Queue');
            system.debug('IsUserChecked---------------->'+IsUserChecked);
            if(IsUserChecked == false)
            {
                ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.ERROR,System.label.You_are_not_authorized_person);
                ApexPages.addMessage(myMsg); 
                return;
            }
            
            //Rejected
            Approval.ProcessWorkitemRequest req = new Approval.ProcessWorkitemRequest();
            req.setComments('Rejected');
            req.setAction('Reject');
            //req.setNextApproverIds(new Id[] {opp.Next_Approver__c});
            Id workItemId = getWorkItemId(objMonthlyTimeSheet.id); 
            
            if(workItemId == null)
            {
                ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.ERROR,'Please ensure request to Approval.');
                ApexPages.addMessage(myMsg); 
                return ;
            }
            else
            {
                req.setWorkitemId(workItemId);
                // Submit the request for approval
                Approval.ProcessResult result =  Approval.process(req);
                
                if(result.isSuccess() == true)
                {
                    //Update Monthly TimeSheet Status Change to Submitted to SCO. 
                    objMonthlyTimeSheet.Monthly_Timesheet_Status__c = '';
                    update objMonthlyTimeSheet;
                    
                    //Insert record Approval History Object.
                    insertApprovalHistory(objMonthlyTimeSheet.id,'Rejected','');
                    
                    //Button(Ready for SCO,Reject and Manually keyed) Enable or disable as status condition.
                    disableSubmitToSCO = true;
                    disableReject = true;
                    //disableFinalSubmitToSCO = true;
                    disableManuallyKeyed = true;
                    
                    ApexPages.Message myMsg = new ApexPages.Message(ApexPages.Severity.CONFIRM,system.label.Timesheet_has_been_rejected);
                    ApexPages.addMessage(myMsg); 
                    return ;
                }
                else{
                    return ;
                }
            }
        }
    }
    
    
    //Send to DocuSign 
    public pagereference sendToDocuSign(){
        insertAttachment();
        return new pagereference('/apex/dsfs__DocuSign_CreateEnvelope?SourceID='+objMonthlyTimeSheet.id);
    }
    public void insertAttachment(){
        system.debug('objMonthlyTimeSheet--------------'+objMonthlyTimeSheet.id);
        list<Attachment> lstOfAttachment = [select id from Attachment where ParentId =:objMonthlyTimeSheet.id];
        if(lstOfAttachment.size()>0){
            delete lstOfAttachment;
            attachTimesheet();
        }else{
            attachTimesheet();
        }
    }
    public void attachTimesheet(){
        /* Get the page definition */
        PageReference pdfPage = Page.monthlyTimesheetViewPdf_Stipend;
        
        /* set the MonthlyTimesheetId id on the page definition */
        pdfPage.getParameters().put('id',objMonthlyTimeSheet.id);
        
        /* generate the pdf blob */
        //Blob pdfBlob = pdfPage.getContent();
        
        Blob pdfBlob = Test.isRunningTest() ? Blob.valueOf('testblob') : pdfPage.getContent();
        
        /* create the attachment against the MonthlyTimesheetView */
        Attachment attachment = new Attachment();
        attachment.Body = pdfBlob;
        attachment.Name = String.valueOf('MonthlyTimesheetView.pdf');
        attachment.ParentId = objMonthlyTimeSheet.id; 
        insert attachment;
        system.debug('attachment'+attachment.Id);
    }
    public string getviewVersions(){
        string url = '/apex/monthlyTimesheetView_Stipend?id='+objMonthlyTimeSheet.id +'&view=false&docusign=false'; 
        return url;
    }
    public void closePopup() {
        displayPopup = false;
    }
    
    public void showPopup() {
        displayPopup = true;
    }
    
}

<apex:page standardController="Monthly_Timesheet__c" extensions="clsExtensionMonthlyTimesheetView_Stipend" lightningStylesheets="true" id="pg" standardStylesheets="false"  sidebar="false">
    <!--<apex:stylesheet value="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"/> -->
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
   
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js">
        </script>
    <script type="text/javascript">
    var $=jQuery.noConflict();
    //$(document).ready(function(){
     $(document).on("keydown", function (e) {
        if (e.key == "F5" || e.key == "F11" || 
            (e.ctrlKey == true && (e.key == 'r' || e.key == 'R')) || 
            e.keyCode == 116 || e.keyCode == 82) {

                   e.preventDefault();
        }
         //  });
     });
   
   </script>  
    <apex:slds />
    <apex:includeScript value="{!$Resource.jquery}"/>
    <apex:stylesheet value="{!$Resource.style_resources}"/>
    <apex:stylesheet value="{!URLFOR($Resource.bootstrap, 'Bootstrap/css/font-awesome.css')}"/>
    <apex:stylesheet value="{!$Resource.monthlyTimesheetView_Stipend}"/>
  
       <style type="text/css">
        .pbHeader {clear:both!important; text-align: left!important; background-color: #FFFFFF!important;}
        .pbTitle {width: 15%!important}
        .requiredLegend{
        display:none;
        }
        .requiredText{
        display:none;
        }
        #first {
        width: 30%;
        float: left;
        height: 230px;
        }
        #first:nth-of-type(odd) {
        margin-right: 10px;
        }
        #second {
        width: 30%;
        float: left;
        height:200px;
        margin-right: 10px;
        }
        
        
        .bPageBlock .requiredInput .requiredBlock {
        background-color:blue;
        }
        .Stipend_Popup{
        background-color: white;
        border-style: solid;
        border-width: 1px;
        left: 50%;
        padding:10px;
        position: absolute;
        z-index: 9999;
        width: 586px;
        margin-left: -273px;
        top:9px;
        }
        .STI_popupBackground{
        background-color:black;
        opacity: 0.20;
        filter: alpha(opacity = 20);
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 9998;
        }
    </style>
    <apex:form id="frm">       
      
        <apex:actionStatus id="counterStatus">
            <apex:facet name="start">
                <i class="fa fa-spinner fa-spin"></i>
                <div id="opaque" style="display:block;"/>
            </apex:facet>
        </apex:actionStatus>
        
        <apex:pageBlock id="pgblock" mode="maindetail" >
            <apex:actionFunction name="getTimesheetIds" status="counterStatus" action="{!getTimesheetIds}" reRender="pbsec,pbsec2,pbsec3,pbtable,pbtable2,pbtable3">
                <apex:param name="strDialyTimesheetDate" value=""/>
            </apex:actionFunction>  
            <apex:outputPanel id="msgId" >
            <apex:pageMessages ></apex:pageMessages>
            </apex:outputPanel>
            <apex:outputText value="Error :" rendered="{!if(lstOfErrorMessages.size > 0 ,true,false)}" escape="errors"/> 
            <apex:dataList value="{!lstOfErrorMessages}" var="Error"  >
                <apex:outputText value="{!Error}" style="color:red;"/>
            </apex:dataList>
            <br/>
            <apex:pageBlockButtons style="text-align:center;" location="top"> <!--rendered="{!IsCheckSubmittedToHr}" disabled="{!disableSubmittedToHr}"  -->
                <apex:commandButton value="Submit to HR" action="{!SubmittedtoHR}" rendered="{!IsCheckSubmittedToHr}" disabled="{!disableSubmittedToHr}" styleClass="slds-button slds-button--brand" />
                <apex:commandButton value="Reject" action="{!submitToReject}" rendered="{!IsCheckSCOAndReject}" disabled="{!disableReject}" styleClass="slds-button slds-button--brand" />
                <apex:commandButton value="Ready For SCO" action="{!submitToSCO}" rendered="{!IsCheckSCOAndReject}" disabled="{!disableSubmitToSCO}" styleClass="slds-button slds-button--brand" /> 
                <apex:commandButton value="Manually Keyed" action="{!submitToManuallyKeyed}" rendered="{!IsCheckSCOAndReject}" disabled="{!disableManuallyKeyed}" styleClass="slds-button slds-button--brand" />
                <apex:commandButton value="Show Stipend Calculation" action="{!showPopup}"  styleClass="slds-button slds-button--brand" rendered="{!IsStipendEnable}" rerender="STI_CAL_popup"/>
                <apex:commandButton value="Print PDF" action="{!viewMonthlyTimesheetPdf}" styleClass="slds-button slds-button--brand" />
                <apex:commandButton value="Send for docuSign"  action="{!sendToDocuSign}"   styleClass="slds-button slds-button--brand" />   
                <apex:outputLabel rendered="{!if(IsselectionVersion == true,true,false)}" >
                    <b>MT Version</b>&nbsp;
                    <apex:selectList value="{!selectedversions}"  size="1" >
                        <apex:actionSupport event="onchange" action="{!selectedVersionTimesheetEntries}" />
                        <apex:selectOptions value="{!MtVersion}"/> 
                    </apex:selectList>
                </apex:outputLabel>    
            </apex:pageBlockButtons>  
            
            <!----------------------------------------When Submit To HR button Click then Error Message Show---------------------------------->
            <br/>
            <body id ="mainBody" >
                <h4  style="display:inline-table;padding-left:24%"><b><center> CALIFORNIA CONSERVATION CORPS  <br/>
                    CM ABSENCE AND ADDITIONAL TIME WORKED REPORT (CCC 634 TIMESHEET)
                    {!dateTimeZone}</center></b>
                </h4>
                <table >
                    <apex:repeat value="{!lstMainWrapper}" var="Main">
                        <tr>
                            <td width="100%" style="text-align:center;" ><b>PAY PERIOD:</b>&nbsp;{!Main.objMonthlyTimesheet.Pay_Period__r.name} - &nbsp;<apex:outputText value="{0, date,M'/'d'/'y}">
                                <apex:param value="{!Main.objMonthlyTimesheet.Pay_Period_Start_Date__c}" />
                                </apex:outputText> &nbsp; To &nbsp;
                                <apex:outputText value="{0, date,M'/'d'/'y}">
                                    <apex:param value="{!Main.objMonthlyTimesheet.Pay_Period_End_Date__c}" />
                                </apex:outputText>
                            </td>
                        </tr>
                        <tr>
                            <td width="100%" style="text-align:center;"><b>DATE OF INJURY:</b>&nbsp; <apex:outputText value="{0, date,M'/'d'/'y}">
                                <apex:param value="{!dtDateOfInjury}" />
                                </apex:outputText>
                            </td>
                        </tr>
                        <!--------------------------------------------Contact Name and Position Number display against Monthly Timesheet------------------------------------>
                        <br/>
                        <tr>
                            <td width="100%">&nbsp;</td>
                        </tr>
                        <tr>
                            <td  style="padding-left:15%; padding-right:15%">
                                <table border="1" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td style="padding-left:2px;" colspan="2"><b>NAME:</b><br/>{!Main.objMonthlyTimesheet.Contact__r.firstname}&nbsp;{!Main.objMonthlyTimesheet.Contact__r.lastname}</td>
                                        <td style="padding-left:2px;" colspan="2"><b>CCC ID:</b><br/>{!Main.objMonthlyTimesheet.Contact__r.CCC_ID__c}</td>
                                        <td style="padding-left:2px;" colspan="2"><b>POSITION NUMBER:</b><br/>{!Main.objMonthlyTimesheet.Position__r.name}</td>                
                                        <td style="padding-left:2px;" colspan="3"><b>Position Effective Date:&nbsp;</b><br/>
                                            <apex:outputText value="{0, date,M'/'d'/'y}"> <apex:param value="{!Main.objMonthlyTimesheet.Position__r.Position_Effective_Date__c}" />
                                            </apex:outputText>
                                        </td>
                                        <td style="padding-left:2px;" colspan="3"><b>Position Expiration Date:&nbsp;</b><br/>
                                            <apex:outputText value="{0, date,M'/'d'/'y}"> <apex:param value="{!Main.objMonthlyTimesheet.Position__r.Position_Expiration_Date__c}" />
                                            </apex:outputText>
                                        </td>
                                        
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        
                        <tr>
                            <td width="100%">&nbsp;</td>
                        </tr>
                        <!-------------------------------------------Week days display  Pay Period start date to end date against Monthly Timesheet------------------------------------------>
                        <tr >
                            <td>
                                <table border="1" width ="100%" cellpadding="0" cellspacing="0" style = "table-layout: fixed; font-size :12px;" id ="Maintable">
                                    <tr >
                                        <td style="padding-left:2px; width : 10%;"><b>DAYS:</b></td>
                                        <apex:repeat value="{!Main.lstOfDays}" var="Days">
                                            <td style="text-align:center;" ><b>{!Days}</b></td>
                                        </apex:repeat>
                                        <td style="padding-left:2px; width : 4.5%;"><b>Monthly<br/>&nbsp;&nbsp;Total</b></td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px;"><b>DATES:</b></td>
                                        <apex:repeat value="{!Main.lstOfdates}" var="Dates" >
                                            <td style="{!if((mapOfDateVsStateHoliday1[Dates] == 'Test') ||(mapOfDateVsStateHoliday2[Dates] != 'null') ,'color:red;font-weight: bold;text-align:center;background-color:  yellow;', 'text-align:center;')}">
                                                <!-- changes for defect: 3382 by Eitika Verma on 10/11/2016 -->
                                                <apex:outputLabel rendered="{!IF(( mapOfDateVsStateHoliday[Dates]=='null' &&  mapOfDateVsStateHoliday1[Dates] != 'Test'),true,false)}" > {!Dates}</apex:outputLabel>
                                                <apex:outputLabel rendered="{!IF((mapOfDateVsStateHoliday!=null && mapOfDateVsStateHoliday[Dates]!='null' && mapOfDateVsStateHoliday2[Dates] == 'null'),true,false)}" onclick="window.open('/apex/STI_Dailytimesheet?id={!mapOfDateVsStateHoliday[Dates]}');" style="text-decoration: underline;font-weight:normal;cursor:pointer;" > {!Dates}</apex:outputLabel>
                                                <apex:outputLabel rendered="{!IF((mapOfDateVsStateHoliday1[Dates] == 'Test'),true,false)}" style="text-align:center;background-color:  yellow;" title="State Holiday"> {!Dates}</apex:outputLabel>                       
                                                <apex:outputLabel rendered="{!IF((mapOfDateVsStateHoliday2[Dates] != 'null'),true,false)}" onclick="window.open('/apex/STI_Dailytimesheet?id={!mapOfDateVsStateHoliday[Dates]}');"  style="text-decoration: underline;color:red;background-color:yellow;border-radius:100%;cursor:pointer;"> {!Dates}</apex:outputLabel>                       
                                            </td>
                                        </apex:repeat>
                                        <td style="padding-left:2px;">&nbsp;</td>
                                    </tr>        
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>                        
                                    <tr>
                                        <td style="padding-left:2px; vertical-align:middle">WORKERS COMP (OW)</td>
                                        <apex:repeat value="{!Main.lstOfOW}" var="listofWC">
                                            <td style="text-align:center;">
                                                {!SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(listofWC,'(',''),')',''),',','')}
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;"></td>
                                    </tr>     
                                    <tr>
                                        <td style="padding-left:2px; vertical-align:middle">WORKERS COMP (MD)</td>
                                        <apex:repeat value="{!Main.lstOfMD}" var="listofWC">
                                            <td style="text-align:center;">
                                                {!SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(listofWC,'(',''),')',''),',','')}
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;"></td>
                                    </tr>     
                                    <tr>
                                        <td style="padding-left:2px; vertical-align:middle">WORKERS COMP (NMD)</td>
                                        <apex:repeat value="{!Main.lstOfNMD}" var="listofWC">
                                            <td style="text-align:center;">
                                                {!SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(listofWC,'(',''),')',''),',','')}
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;"></td>
                                    </tr>                     
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px;"><b>TOTAL HOURS</b></td>
                                        <apex:repeat value="{!Main.lstOfProjectWorked}" var="ProjectWorked">
                                            <td style="text-align:center;"><apex:commandLink value="{!ProjectWorked.projectWorked}" onclick="showProjectBlock('{!ProjectWorked.projectTimesheetDate}','{!ProjectWorked.projectWorked}');return false;" reRender="pg" styleclass="js-open-modal" >
                                                </apex:commandLink>
                                            </td>
                                        </apex:repeat>                        
                                        <td style="text-align:center;">{!TotalTotalHours }</td>
                                    </tr>                    
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px;">PAID HOURS <br/>(NON-EH)</td>
                                        <apex:repeat value="{!Main.lstOfNEH}" var="NEH">
                                            <td style="text-align:center;">
                                                <apex:outputtext rendered="{!if(NEH != '0',true,false)}">{!NEH}</apex:outputtext></td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotalNEH }</td>
                                    </tr>
                                    
                                    <tr>
                                        <td style="padding-left:2px;">UNPAID HOURS (NON-EH)</td>
                                        <apex:repeat value="{!Main.lstOfSickLeave}" var="Sickleave">
                                            <td style="text-align:center;">
                                                <apex:outputtext rendered="{!if(Sickleave != '0',true,false)}">{!Sickleave}</apex:outputtext></td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotalSickLeave}</td>
                                    </tr>
                                    
                                    <tr>
                                        <td style="padding-left:2px;">EMERGENCY HOURS</td>
                                        <apex:repeat value="{!Main.lstOfVacationLeave}" var="lstOfVacationLeave" >
                                            <td style="text-align:center;">
                                                <apex:outputtext rendered="{!if(lstOfVacationLeave != '0',true,false)}">{!lstOfVacationLeave}</apex:outputtext>
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotalVacationLeave }</td>
                                    </tr>                             
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>             
                                    <tr>
                                        <td style="padding-left:2px;">USED PLC</td>
                                        <apex:repeat value="{!Main.lstOfPersonalHoliday}" var="lstOfPersonalHoliday">                           
                                            <td style="text-align:center;">
                                                <apex:outputtext rendered="{!if(lstOfPersonalHoliday != '0',true,false)}">{!lstOfPersonalHoliday}</apex:outputtext>
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotalPersonalHoliday }</td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px;">USED HLC</td>
                                        <apex:repeat value="{!Main.lstOfHolidayExcess}" var="lstOfHolidayExcess">
                                            <td style="text-align:center;"> 
                                                <apex:outputtext rendered="{!if(lstOfHolidayExcess != '0',true,false)}">{!lstOfHolidayExcess}</apex:outputtext>
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotalHolidayExcess }</td>
                                    </tr>
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>
                                    <tr style = "word-spacing: 9999rem;">
                                        <td style="padding-left:2px; vertical-align:middle;"> MISCELLANEOUS ENTRY</td>
                                        <apex:repeat value="{!Main.lstOfMiscTime}" var="lstOfMiscTime" >
                                            <td style="text-align:center;" width="3px">
                                                {!SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(lstOfMiscTime,'(',''),')',''),',','')}
                                                
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px; vertical-align:middle">MEDICAL ABSENCE ENTRY</td>
                                        <apex:repeat value="{!Main.listofMA}" var="listofMA">
                                            <td style="text-align:center;">
                                                
                                                {!SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(listofMA,'(',''),')',''),',','')}
                                            </td>
                                        </apex:repeat>
                                        <td style="text-align:center;"></td>
                                    </tr>   
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px;">ENROLLED?</td>
                                        <apex:repeat value="{!Main.lstOfRDO}" var="lstOfRDO">
                                            <td style="text-align:center;">{!lstOfRDO}</td>
                                        </apex:repeat>
                                        <td style="text-align:center;"></td>
                                    </tr>
                                    <tr>                           
                                        <apex:repeat value="{!Main.lstOfNEH}" var="OW">
                                            <td style="border:none;" >&nbsp;</td>
                                        </apex:repeat>                           
                                        <td style="border:none;" >&nbsp;</td>
                                        <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                    </tr>
                                    
                                    <tr>
                                        <td style="padding-left:2px;">NEDEEH</td>
                                        <apex:repeat value="{!Main.lstOfNEDEEH}" var="lstOfNEDEEH">
                                            <td style="text-align:center;">{!lstOfNEDEEH}</td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotaldecDEEH }</td>
                                    </tr>
                                    <tr>
                                        <td style="padding-left:2px;">EDEEH</td>
                                        <apex:repeat value="{!Main.lstOfEDEEH}" var="lstOfEDEEH">
                                            <td style="text-align:center;">{!lstOfEDEEH}</td>
                                        </apex:repeat>
                                        <td style="text-align:center;">{!TotaldecEDEEH }</td> 
                                    </tr>
                                    
                                </table>
                            </td>
                        </tr>
                    </apex:repeat>
                </table>
                <br/>
                <div  id="first" >
                    <table border = "1"  cellpadding="0" cellspacing="0" align="center" id="firstdiv" > 
                        <tr>
                            <th  style="padding-left:10px;text-align:left;"><b>Monthly Timesheet Summary</b></th>
                        </tr>
                        <!--  <tr>
<td style="padding-left:10px;text-align:left;"><b>Emergency Excess Time<span style="padding-left:100px;text-align:left;"></span>:</b>&nbsp;{!objMonthlyTimeSheet.EET__c}</td>     
</tr> -->
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Unit<span style="padding-left:220px;text-align:left;"></span>:</b>&nbsp;{!objMonthlyTimeSheet.Contact__r.Unit__r.Name}</td>
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Emergency Excess Time Bonus<span style="padding-left:58px;text-align:left;"></span>:</b>                          
                                <apex:outputText value="{0, number, ###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.EETB__c}" /> </apex:outputText>
                            </td>
                        </tr> 
                        <tr>
                            <td style="padding-left:10px;text-align:left;" ><b>Monthly Timesheet  Status<span style="padding-left:83px;text-align:left;"></span>:</b>&nbsp;{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c}</td>  
                        </tr>   
                        <tr>             
                            <td  style="padding-left:10px;text-align:left;"><b>Prorated Days<span style="padding-left:161px;text-align:left;"></span>:</b>&nbsp;              
                                <apex:outputText value="{0, number,###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.PD__c}" /> </apex:outputText>
                            </td>             
                        </tr> 
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Daily Proration Amount<span style="padding-left:100px;text-align:left;"></span>:</b>&nbsp;             
                                <apex:outputText value="{0, number,###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.DPA__c}" /> </apex:outputText> 
                            </td>
                        </tr>
                        <tr>             
                            <td  style="padding-left:10px;text-align:left;"><b>TNEEEH<span style="padding-left:196px;text-align:left;"></span>:</b>&nbsp;         
                                <apex:outputText value="{0, number,###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.TNEEEH__c}" /> </apex:outputText> 
                            </td>             
                        </tr>
                        <tr>             
                            <td  style="padding-left:10px;text-align:left;"><b>TEEEH<span style="padding-left:206px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.TEEEH__c}" /> </apex:outputText>
                            </td>             
                        </tr>
                        
                        <apex:outputPanel layout="none" rendered="{!IF($Profile.Name == 'C Profile 4',true,false)}">
                            <tr>
                                <td  style="padding-left:10px;text-align:left;"><b>Stipend Units<span style="padding-left:160px;text-align:left;"></span>:</b>        
                                    <apex:outputText value="{0, number, ###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.SU__c}" /> </apex:outputText>
                                </td>
                            </tr>
                        </apex:outputPanel>
                        <!-- <apex:outputPanel layout="none"  rendered="{!IF((MTSStatus == ' ' || MTSStatus == null),false,true)}"> -->
                        <tr>                          
                            <td  style="padding-left:10px;text-align:left;"><b>Stipend Amount<span style="padding-left:141px;text-align:left;"></span>:</b>       
                                <apex:outputText value="{0, number, ###,###,##0.##}" rendered="{!objMonthlyTimeSheet.Monthly_Timesheet_Status__c != ''}"> <apex:param value="{!objMonthlyTimeSheet.SASTSCO__c}" /> </apex:outputText>
                            </td>
                        </tr>
                        <!--    </apex:outputPanel> -->
                        <!--  <tr>
<td  style="padding-left:10px;text-align:left;"><b>Total Stipend Amount<span style="padding-left:109px;text-align:left;"></span>:</b>            
<apex:outputText value="{0, number, ###,###,##0.##}" > <apex:param value="{!objMonthlyTimeSheet.Stipend_Units__c * objMonthlyTimesheet.EEHR__c}" /> </apex:outputText>
</td>
</tr> -->
                    </table>
                </div>
                <div  id="second">
                    <table border = "1" cellpadding="0" cellspacing="0" align="center">            
                        <tr>
                            <th style="padding-left:10px;text-align:left;">Personal Leave Credit Summary</th>
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Available<span style="padding-left:157px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Available_Personal_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>            
                            <td style="padding-left:10px;text-align:left;"><b>Used<span style="padding-left:181px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Used_Personal_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Awarded<span style="padding-left:157px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Awarded_Personal_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>                
                            <td width ="25%" style="padding-left:10px;text-align:left;"><b>Balance<span style="padding-left:163px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Balance_Personal_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Personal Leave Adjustment<span style="padding-left:44px;text-align:left;"></span>:</b>&nbsp;            
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Personal_Leave_Adjustment__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                    </table>
                </div>
                <div  id="second">
                    <table border = "1" cellpadding="0" cellspacing="0" align="center" >            
                        <tr >
                            <th style="padding-left:10px;text-align:left;">Holiday Leave Credit Summary</th>
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Available<span style="padding-right:100px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Available_Holiday_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Used<span style="padding-left:125px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Used_Holiday_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Awarded<span style="padding-left:100px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Awarded_Holiday_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Balance<span style="padding-left:107px;text-align:left;"></span>:</b>&nbsp;
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Balance_Holiday_Leave_Credits__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                        <tr>
                            <td style="padding-left:10px;text-align:left;"><b>Separation Cash out<span style="padding-left:29px;text-align:left;"></span>:</b>&nbsp;                
                                <apex:outputText value="{0, number,###,###,##0.##}"> <apex:param value="{!objMonthlyTimeSheet.STI_Separations_Cashout__c}" /> </apex:outputText>
                            </td> 
                        </tr>
                    </table>
                </div>
                <div  style="padding-left:10%; padding-right:10%">
                    <table border="1" width ="70%" cellpadding="0" cellspacing="0" align="center" >
                        <tr>
                            <td width="50%" style="padding-left:2px;height:80px;"><apex:outputtext value="CORPSMEMBER & DATE:" rendered="{!if(objMonthlyTimeSheet.Position__r.Worker_Type__c == 'CM',true,false)}"/>
                                <apex:outputtext value="SPECIAL CORPSMEMBER & DATE:" rendered="{!if(objMonthlyTimeSheet.Position__r.Worker_Type__c == 'SPCM',true,false)}"/>
                                <br/><br/><br/><br/>To the best of my knowledge and belief, the facts stated are accurate and in full compliance with legal requirements.</td>
                            <td width="50%" style="padding-left:2px;height:80px;">SUPERVISOR &amp; DATE:<br/><br/><br/><br/>To the best of my knowledge and belief, the facts stated are accurate and in full compliance with legal requirements.</td>
                        </tr>
                        <tr>
                            <td width="50%" style="padding-left:2px;height:80px;">AUDITED/POSTED BY &amp; DATE:<br/><br/><br/></td>
                            <td width="50%" style="padding-left:2px;height:80px;">REVIEWED BY &amp; DATE:<br/><br/><br/></td>
                        </tr>
                    </table>
                </div>
            </body>
            <br/>
            <br/>
            
            <!--------------------------------------------- Create Custom Popup to Project Timesheet Entries ----------------------------------------------------->
            
            <div id="projectEditpopup" class="modal-box" style="top: 100px; left: 350px; display: none;">  
                <div class="modal-body">
                    <apex:pageBlock >
                        <apex:pageBlockButtons location="bottom">
                            <apex:commandButton value="Close" onclick="hidePopupBlock()"  styleclass="btn btn-info btn-lg" rerender="errorPanel" style="margin-left:200px;background: #1797C0;color:#FFF"/>
                        </apex:pageBlockButtons>
                        <apex:pageBlockSection columns="1" collapsible="false">
                            <apex:facet name="header">                             
                                <apex:outputpanel id="pbsec">
                                    <apex:outputText style="font-weight:bold;font-size:12px;float:left;" value="Project Time Entry"/>
                                    <apex:outputText style="font-weight:bold;font-size:12px;padding-left:21%;" value="Time Entry Date: {0,date,M'/'d'/'y}">
                                        <apex:param value="{!timesheetEntryDate}" />
                                    </apex:outputText>
                                    <apex:outputText style="font-weight:bold;font-size:12px;float:right;" value="Total Hours: {!TotalHours}"/>
                                </apex:outputpanel>                                
                            </apex:facet>
                            <apex:pageBlockTable value="{!lstOfWrapperPopup}" var="wrap" id="pbtable"> 
                                <apex:column headerValue="Project Name" value="{!wrap.ProjectName}"/>
                                <apex:column headerValue="Project Type" value="{!wrap.ProjectType}"/>
                                <apex:column headerValue="Project Number" value="{!wrap.ProjectNumber}"/>
                                <apex:column headerValue="Project Hours" value="{!wrap.ProjectHours}"/>                               
                            </apex:pageBlockTable>                             
                        </apex:pageBlockSection> 
                        <apex:pageBlockSection columns="1" collapsible="false" >
                            <apex:facet name="header">                             
                                <apex:outputpanel id="pbsec2">
                                    <apex:outputText style="font-weight:bold;font-size:12px;float:left;" value="Leave Time Entry" />
                                </apex:outputpanel>                                
                            </apex:facet>
                            <apex:pageBlockTable value="{!llstOfWrapperPopup}" var="wrap" id="pbtable2">
                                <apex:column headerValue="Personal Leave Credit Used" value="{!wrap.LeaveEntry}"/>
                                <apex:column headerValue="Holiday Leave Credit Used" value="{!wrap.HolidayLeaveEntry}"/>                   
                            </apex:pageBlockTable>                             
                        </apex:pageBlockSection>
                        <apex:pageBlockSection columns="1" collapsible="false">
                            <apex:facet name="header">                             
                                <apex:outputpanel id="pbsec3">
                                    <apex:outputText style="font-weight:bold;font-size:12px;float:left;" value="Miscellaneous Time Entry" />
                                </apex:outputpanel>                                
                            </apex:facet>
                            <apex:pageBlockTable value="{!mlstOfWrapperPopup}" var="wrap" id="pbtable3" >
                                <apex:column headerValue="Miscellaneous" value="{!wrap.Miscellaneous}" />
                                <apex:column headerValue="Medical Absence" value="{!wrap.MedicalAbsence}"/>                   
                            </apex:pageBlockTable>                             
                        </apex:pageBlockSection>
                        
                    </apex:pageBlock>
                </div>         
            </div>  
            <div id="paidProjectEditpopup" class="modal-box" style="top: 150px; left: 425px; display: none;">  
                <div class="modal-body">
                    <apex:pageBlock >
                        <apex:pageBlockButtons location="bottom">
                            <apex:commandButton value="Close" onclick="hidePopupBlock()"  styleclass="js-modal-close btn btn-default btn-primary" rerender="errorPanel" style="margin-left: 110px;"/>
                        </apex:pageBlockButtons>
                        <apex:pageBlockSection columns="1" collapsible="false">
                            <apex:facet name="header">
                                
                                <apex:outputpanel id="pbsec1">
                                    <apex:outputText style="font-weight:bold;font-size:12px;float:left;" value="Time Entry Date: {0, date,M'/'d'/'y}">
                                        <apex:param value="{!timesheetEntryDate}" />
                                    </apex:outputText>
                                    <apex:outputText style="font-weight:bold;font-size:12px;float:right;" value="Total Paid Hours: {!TotalPaidHours}"/>
                                </apex:outputpanel>
                                
                            </apex:facet>
                            
                            
                        </apex:pageBlockSection>
                    </apex:pageBlock>  
                </div>         
            </div>       
            <!-------------------------------------------------------------Approval History--------------------------------------------------------------->
            <apex:outputPanel rendered="{!if(ApprovalHistory.size > 0 ,true,false)}">
                <apex:pageBlock mode="edit" > 
                    <apex:pageBlockSection title="Approval History" columns="1" >
                        <apex:pageBlockTable value="{!ApprovalHistory}" var="x" >
                            <apex:column headerValue="Activity Date">  
                                <apex:outputText value="{0,date,dd-MMM-yyyy HH:mm:aa }"> 
                                    <apex:param value="{!x.CreatedDate}" /> 
                                </apex:outputText>
                            </apex:column>
                            
                            <apex:column headerValue="Reviewer Name">
                                <apex:outputLink value="/{!x.Reviewer_Name__c}" target="_blank">    
                                    {!x.Reviewer_Name__r.FirstName} &nbsp; {!x.Reviewer_Name__r.LastName}
                                </apex:outputLink>
                            </apex:column>
                            
                            <!--<apex:column headerValue="Title">    
{!x.CreatedDate}
</apex:column>-->
                            
                            <apex:column headerValue="Status">    
                                {!x.Reviewer_Decision__c}
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageblockSection>
                </apex:pageBlock>
            </apex:outputPanel>
            <!-------------------------------sTIPEND cALCULATION pOPUP------------------------------------------>
            <apex:outputPanel id="STI_CAL_popup">
                <apex:outputPanel styleClass="STI_popupBackground" layout="block" rendered="{!displayPopUp}"/>
                <apex:outputPanel styleClass="Stipend_Popup" layout="block" rendered="{!displayPopUp}">
                    <table border="2" width ="20%" cellpadding="0" cellspacing="0" align="center">
                        
                        <div align="center" style="padding-left:20%; padding-right:20%;">
                            <H1 style="font-size:150%;"><b>Stipend Calculations Summary</b></H1>
                        </div>
                        <br/>
                        <tr>
                            <td colspan="2">
                                <div align="center" style="padding-left:2%; padding-right:2%; padding-top:2%; padding-bottom:2%;">
                                    <table border="1" width ="20%" cellpadding="0" cellspacing="0" align="center">
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;" colspan="2"><b>Stipend Calculations prior to submission of SCO</b><br/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td width ="25%" style="padding-left:2px; word-wrap: break-word;">Non-Adjusted Stipend Amount:</td>
                                            <td width ="25%" style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.NASA__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Stipend Units:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.SU__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Total Non Emergency Emergency Excess Hours (TNEEEH):</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.TNEEEH__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Total Emergency Emergency Excess Hours (TEEEH):</td>
                                            <td style="padding-left:2px; word-wrap: break-word;"> {!objMonthlyTimesheet.TEEEH__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Total Emergency Excess Time:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.TEET__c}</td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                        </tr>
                        <tr>                           
                            <td style="border:none;" >&nbsp;</td>
                            <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                        </tr>
                        <tr>
                            <td>
                                <div align="center" style="padding-left:2%; padding-right:2%; padding-top:2%; padding-bottom:2%;">
                                    <table border="1" width ="20%" cellpadding="0" cellspacing="0" align="center">
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;" colspan="2"><b>Variables defined based on Class Code and Pay Period</b><br/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">EEH Multiplier(EEHM):</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.EEHM__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Emergency Excess Hourly Rate(EEHR):</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.EEHR__c}</td>
                                            
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Base Stipend Amount :</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.BSA__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Base Stipend Units:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.BSU__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;" >Days In Month(DIM):</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.DIM__c} </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Daily Proration Amount(DPA):</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.DPA__c}</td>
                                        </tr>
                                    </table></div>
                            </td>
                            <td>
                                <div align="center" style="padding-left:2%; padding-right:2%; padding-top:2%; padding-bottom:2%;">
                                    <table border="1" width ="20%" cellpadding="0" cellspacing="0" align="center">
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;" colspan="2"><b>Variables defined based on the Time Entries</b><br/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Days Not Enrolled:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.DNE__c}</td>
                                        </tr>
                                        
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Pro-rated Days :</td>
                                            <td style="padding-left:2px; word-wrap: break-word;"> {!objMonthlyTimesheet.PD__c}</td>
                                        </tr>  
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">P$Stipend:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;"> {!objMonthlyTimesheet.PS__c}</td>
                                        </tr>
                                        
                                    </table></div>
                            </td>
                        </tr>
                        <tr>                           
                            <td style="border:none;" >&nbsp;</td>
                            <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div align="center" style="padding-left:2%; padding-right:2%; padding-top:2%; padding-bottom:2%;">
                                    <table border="1" width ="20%" cellpadding="0" cellspacing="0" align="center">
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;" colspan="2"><b>Amounts to be Submitted to SCO</b><br/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Stipend Amount Submitted to SCO:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.SASTSCO__c} </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Stipend Units Submitted to SCO:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;"> {!objMonthlyTimesheet.SU__c}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Total Non-Emergency Emergency Excess Time Bonus Submitted to SCO:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.TNEETBSTSCO__c} </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Total Emergency Emergency Excess Time Bonus Submitted to SCO:</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.TEETBSTSCO__c} </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:2px; word-wrap: break-word;">Total Emergency Excess Time Bonus Submitted to SCO :</td>
                                            <td style="padding-left:2px; word-wrap: break-word;">{!objMonthlyTimesheet.TEETBSTSCO__c+objMonthlyTimesheet.TNEETBSTSCO__c} </td>
                                        </tr>
                                        <tr>                           
                                            <td style="border:none;" >&nbsp;</td>
                                            <td style="border-right:1px;border-left:0px" >&nbsp;</td>
                                        </tr>  
                                    </table></div>
                            </td>
                        </tr>
                        
                    </table>
                    <br/>
                    <div align="center" style="padding-left:20%; padding-right:20%">
                        <apex:commandButton value="Close" action="{!closePopup}" styleclass="slds-button slds-button--brand" rerender="STI_CAL_popup"/>
                    </div>
                </apex:outputPanel>
            </apex:outputPanel>
            
            <!------------------------------------------------DocuSign Related List ------------------------------------------------------->
            
            
            <script> 
            
            function showProjectBlock(pjtDate,pjtWorked) {
                getTimesheetIds(pjtDate,pjtWorked);
                setTimeout(ProjectTimesheet, 1000);
            }       
            function PaidProjectTimesheet(){
                var appendthis =  ("<div class='modal-overlay js-modal-close'></div>");
                $("body").append(appendthis);
                $(".modal-overlay").fadeTo(500, 0.7);
                $('#paidProjectEditpopup').fadeIn($(this).data());    
            }
            function ProjectTimesheet(){
                var appendthis =  ("<div class='modal-overlay js-modal-close'></div>");
                $("body").append(appendthis);
                $(".modal-overlay").fadeTo(500, 0.7);
                $('#projectEditpopup').fadeIn($(this).data());    
            }
            function hidePopupBlock(){
                $(".modal-box, .modal-overlay").fadeOut(1000, function() {
                    $(".modal-overlay").remove();
                });
            }
            </script> 
        </apex:pageBlock>
    </apex:form>
    <apex:relatedList list="DocuSign_Status__r" />  
</apex:page>